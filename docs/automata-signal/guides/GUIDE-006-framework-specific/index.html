<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-automata-signal/guides/GUIDE-006-framework-specific" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.7.0">
<title data-rh="true">[GUIDE-006] Ash Framework 특화 가이드 | Automata</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://AutomataOOO.github.io/docs/automata-signal/guides/GUIDE-006-framework-specific"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="[GUIDE-006] Ash Framework 특화 가이드 | Automata"><meta data-rh="true" name="description" content="| 버전 | 날짜       | 변경 내용      |"><meta data-rh="true" property="og:description" content="| 버전 | 날짜       | 변경 내용      |"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://AutomataOOO.github.io/docs/automata-signal/guides/GUIDE-006-framework-specific"><link data-rh="true" rel="alternate" href="https://AutomataOOO.github.io/docs/automata-signal/guides/GUIDE-006-framework-specific" hreflang="en"><link data-rh="true" rel="alternate" href="https://AutomataOOO.github.io/docs/automata-signal/guides/GUIDE-006-framework-specific" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.7e2963ca.css">
<script src="/assets/js/runtime~main.83fab349.js" defer="defer"></script>
<script src="/assets/js/main.cacb38b6.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/img/logo.svg"><div role="region" aria-label="Skip to main content"><a class="skipToContent__HuA" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="Automata Logo" class="themedComponent_Exct themedComponent--light_c3lc"><img src="/img/logo.svg" alt="Automata Logo" class="themedComponent_Exct themedComponent--dark_Ji9V"></div><b class="navbar__title text--truncate">Automata</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/automata-signal/">Docs</a></div><div class="navbar__items navbar__items--right"><div class="toggle_OAgU colorModeToggle_zRe0"><button class="clean-btn toggleButton_aClM toggleButtonDisabled_GkIb" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite" aria-pressed="false"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_zzlY"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_Z832"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Cx4E"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_liLQ"><div class="docsWrapper_evXH"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_nZiY" type="button"></button><div class="docRoot_jKp6"><aside class="theme-doc-sidebar-container docSidebarContainer_wXyP"><div class="sidebarViewport_LQZ0"><div class="sidebar_T0dy"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_WBBB"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" href="/docs/automata-signal/">[APP-001] Automata-Signal</a><button aria-label="Collapse sidebar category &#x27;[APP-001] Automata-Signal&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" tabindex="0" href="/docs/automata-signal/guides/GUIDE-001-getting-started">1. 개발 가이드</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/automata-signal/guides/GUIDE-001-getting-started">[GUIDE-001] 시작하기</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/automata-signal/guides/GUIDE-002-project-structure">[GUIDE-002] Automata 시스템 구조</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/automata-signal/guides/GUIDE-003-ai-driven-development-workflow">[GUIDE-003] AI 주도 개발 워크플로우</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/automata-signal/guides/GUIDE-004-ai-coding-standards-ash-framework">[GUIDE-006] AI 코딩 표준: Ash Framework</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/automata-signal/guides/GUIDE-004-coding-standards">[GUIDE-004] 코딩 표준</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/automata-signal/guides/GUIDE-005-deployment-workflow">[GUIDE-005] 배포 워크플로우</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/automata-signal/guides/GUIDE-006-framework-specific">[GUIDE-006] Ash Framework 특화 가이드</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/docs/automata-signal/designs/DESIGN-001-architecture-overview">2. 시스템 설계</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/docs/automata-signal/components/COMP-002-adapters">3. 컴포넌트 설계</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/docs/automata-signal/sequences/SEQ-001-initialization">4. 프로세스 시퀀스</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/docs/automata-signal/references/REF-001-api">5. 참조 자료</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/docs/automata-signal/planning/PLAN-001-requirements">6. 프로젝트 계획</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/automata-signal/tech-spec">Automata-Signal: 기술 명세서</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/vibe-coding/APP-000-global-rules">vibe-coding</a></div></li></ul></nav></div></div></aside><main class="docMainContainer_dhcR"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_hWfg"><div class="docItemContainer_UIwD"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_ViMa" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_xAfz"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/automata-signal/"><span itemprop="name">[APP-001] Automata-Signal</span></a><meta itemprop="position" content="1"></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">1. 개발 가이드</span><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">[GUIDE-006] Ash Framework 특화 가이드</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_xgD3 theme-doc-toc-mobile tocMobile_UvqM"><button type="button" class="clean-btn tocCollapsibleButton_ldZF">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>[GUIDE-006] Ash Framework 특화 가이드</h1></header>
<table><thead><tr><th>버전</th><th>날짜</th><th>변경 내용</th></tr></thead><tbody><tr><td>1.0</td><td>2025-04-02</td><td>최초 문서 작성</td></tr></tbody></table>
<h2 class="anchor anchorWithStickyNavbar_QJwc" id="요약">요약<a href="#요약" class="hash-link" aria-label="Direct link to 요약" title="Direct link to 요약">​</a></h2>
<p>본 문서는 Automata-Signal 프로젝트에서 Ash Framework를 효과적으로 활용하는 방법에 대한 상세 가이드를 제공합니다. Ash 리소스 정의, 확장 모듈 활용, 액션 구현, 쿼리, 데이터 로딩 등 Ash Framework 특화 내용을 집중적으로 다룹니다. 이 가이드는 Elixir 기반 프로젝트에서 재사용 가능한 참조 자료로 활용할 수 있습니다.</p>
<h2 class="anchor anchorWithStickyNavbar_QJwc" id="1-ash-framework-개요">1. Ash Framework 개요<a href="#1-ash-framework-개요" class="hash-link" aria-label="Direct link to 1. Ash Framework 개요" title="Direct link to 1. Ash Framework 개요">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_QJwc" id="11-ash-framework란">1.1 Ash Framework란?<a href="#11-ash-framework란" class="hash-link" aria-label="Direct link to 1.1 Ash Framework란?" title="Direct link to 1.1 Ash Framework란?">​</a></h3>
<p>Ash Framework는 Elixir 기반의 선언적 데이터 모델링 및 관리 프레임워크입니다. 다음과 같은 핵심 특징을 가집니다:</p>
<ul>
<li><strong>선언적 리소스 정의</strong>: 도메인 모델을 명확하고 응집력 있게 정의</li>
<li><strong>확장 가능한 아키텍처</strong>: 플러그인 형태의 다양한 확장 모듈 지원</li>
<li><strong>풍부한 쿼리 API</strong>: 복잡한 쿼리를 간결하게 작성 가능</li>
<li><strong>강력한 인증/인가</strong>: 세밀한 접근 제어 매커니즘 제공</li>
<li><strong>다양한 데이터 계층</strong>: PostgreSQL, Mnesia 등 다양한 백엔드 지원</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_QJwc" id="12-주요-구성-요소">1.2 주요 구성 요소<a href="#12-주요-구성-요소" class="hash-link" aria-label="Direct link to 1.2 주요 구성 요소" title="Direct link to 1.2 주요 구성 요소">​</a></h3>
<p>Ash Framework는 다음 주요 구성 요소로 이루어져 있습니다:</p>
<ul>
<li><strong>Resource</strong>: 도메인 모델 정의 (엔티티, 속성, 관계)</li>
<li><strong>Action</strong>: 리소스에 대한 작업 정의 (생성, 조회, 수정, 삭제, 커스텀 작업)</li>
<li><strong>Query</strong>: 리소스 데이터 쿼리 및 필터링</li>
<li><strong>Domain</strong>: 관련 리소스 그룹화 및 접근 규칙 관리</li>
<li><strong>Registry</strong>: 리소스 등록 및 검색</li>
<li><strong>DataLayer</strong>: 데이터 저장 및 조회 추상화</li>
<li><strong>Extension</strong>: 기능 확장 모듈 (상태 기계, 아카이빙, 감사 추적 등)</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_QJwc" id="2-ash-리소스-정의-가이드">2. Ash 리소스 정의 가이드<a href="#2-ash-리소스-정의-가이드" class="hash-link" aria-label="Direct link to 2. Ash 리소스 정의 가이드" title="Direct link to 2. Ash 리소스 정의 가이드">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_QJwc" id="21-리소스-기본-구조">2.1 리소스 기본 구조<a href="#21-리소스-기본-구조" class="hash-link" aria-label="Direct link to 2.1 리소스 기본 구조" title="Direct link to 2.1 리소스 기본 구조">​</a></h3>
<div class="language-elixir codeBlockContainer_qNdj theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_enjf"><pre tabindex="0" class="prism-code language-elixir codeBlock_txiP thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_XHAo"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">defmodule</span><span class="token plain"> </span><span class="token module class-name">MyApp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">Resources</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">MyResource</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">use</span><span class="token plain"> </span><span class="token module class-name">Ash</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">Resource</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token attr-name" style="color:#00a4db">data_layer:</span><span class="token plain"> </span><span class="token module class-name">AshPostgres</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">DataLayer</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token attr-name" style="color:#00a4db">extensions:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic"># 필요한 확장 모듈만 추가</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># 속성 정의</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  attributes </span><span class="token keyword" style="color:#00009f">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># 관계 정의</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  relationships </span><span class="token keyword" style="color:#00009f">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># 액션 정의</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  actions </span><span class="token keyword" style="color:#00009f">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># 계산된 속성</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  calculations </span><span class="token keyword" style="color:#00009f">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># 집계 정의</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  aggregates </span><span class="token keyword" style="color:#00009f">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">end</span><br></span></code></pre><div class="buttonGroup_Y8nk"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_FM2O" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_GhTt"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_AhUB"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_QJwc" id="22-속성-정의-모범-사례">2.2 속성 정의 모범 사례<a href="#22-속성-정의-모범-사례" class="hash-link" aria-label="Direct link to 2.2 속성 정의 모범 사례" title="Direct link to 2.2 속성 정의 모범 사례">​</a></h3>
<p>속성(attribute)은 리소스의 데이터 필드를 정의합니다:</p>
<div class="language-elixir codeBlockContainer_qNdj theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_enjf"><pre tabindex="0" class="prism-code language-elixir codeBlock_txiP thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_XHAo"><span class="token-line" style="color:#393A34"><span class="token plain">attributes </span><span class="token keyword" style="color:#00009f">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># 기본 키 (항상 첫 번째로 정의)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  uuid_primary_key </span><span class="token atom symbol" style="color:#36acaa">:id</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># 기본 속성 정의</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  attribute </span><span class="token atom symbol" style="color:#36acaa">:name</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token atom symbol" style="color:#36acaa">:string</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># 제약 조건</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    constraints </span><span class="token punctuation" style="color:#393A34">[</span><span class="token attr-name" style="color:#00a4db">required:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token attr-name" style="color:#00a4db">min_length:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token attr-name" style="color:#00a4db">max_length:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">100</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># 기본값</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    default </span><span class="token string" style="color:#e3116c">&quot;Unnamed&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># 설명 (문서화)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    description </span><span class="token string" style="color:#e3116c">&quot;사용자 이름&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># 열거형(enum) 속성</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  attribute </span><span class="token atom symbol" style="color:#36acaa">:status</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token atom symbol" style="color:#36acaa">:atom</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    constraints </span><span class="token punctuation" style="color:#393A34">[</span><span class="token attr-name" style="color:#00a4db">one_of:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token atom symbol" style="color:#36acaa">:active</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token atom symbol" style="color:#36acaa">:inactive</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token atom symbol" style="color:#36acaa">:pending</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    default </span><span class="token atom symbol" style="color:#36acaa">:pending</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    description </span><span class="token string" style="color:#e3116c">&quot;사용자 상태&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># 구조화된 데이터</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  attribute </span><span class="token atom symbol" style="color:#36acaa">:metadata</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token atom symbol" style="color:#36acaa">:map</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token attr-name" style="color:#00a4db">default:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">%</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># 타임스탬프 (created_at, updated_at)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">timestamps</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># 민감 정보 (암호화 필요)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  attribute </span><span class="token atom symbol" style="color:#36acaa">:api_key</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token atom symbol" style="color:#36acaa">:string</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token attr-name" style="color:#00a4db">sensitive?:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># 비공개 속성 (API 응답에서 제외)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  attribute </span><span class="token atom symbol" style="color:#36acaa">:internal_notes</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token atom symbol" style="color:#36acaa">:string</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token attr-name" style="color:#00a4db">private?:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># 사용자 정의 타입</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  attribute </span><span class="token atom symbol" style="color:#36acaa">:coords</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token module class-name">MyApp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">Types</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">GeoPoint</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">end</span><br></span></code></pre><div class="buttonGroup_Y8nk"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_FM2O" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_GhTt"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_AhUB"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_QJwc" id="속성-정의-규칙">속성 정의 규칙<a href="#속성-정의-규칙" class="hash-link" aria-label="Direct link to 속성 정의 규칙" title="Direct link to 속성 정의 규칙">​</a></h4>
<ol>
<li><strong>기본 키</strong>: 항상 <code>uuid_primary_key :id</code>를 속성 블록 최상단에 정의합니다.</li>
<li><strong>논리적 그룹화</strong>: 관련 속성을 함께 그룹화하고 그룹 간에 주석으로 구분합니다.</li>
<li><strong>제약 조건</strong>: 모든 필수 필드에 <code>constraints [required: true]</code>를 명시합니다.</li>
<li><strong>기본값</strong>: 적절한 기본값을 제공하여 데이터 일관성을 유지합니다.</li>
<li><strong>설명</strong>: 복잡한 속성에는 <code>description</code> 메타데이터를 추가합니다.</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_QJwc" id="23-관계-정의-모범-사례">2.3 관계 정의 모범 사례<a href="#23-관계-정의-모범-사례" class="hash-link" aria-label="Direct link to 2.3 관계 정의 모범 사례" title="Direct link to 2.3 관계 정의 모범 사례">​</a></h3>
<p>관계(relationship)는 리소스 간의 연결을 정의합니다:</p>
<div class="language-elixir codeBlockContainer_qNdj theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_enjf"><pre tabindex="0" class="prism-code language-elixir codeBlock_txiP thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_XHAo"><span class="token-line" style="color:#393A34"><span class="token plain">relationships </span><span class="token keyword" style="color:#00009f">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># 일대다 관계</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  has_many </span><span class="token atom symbol" style="color:#36acaa">:messages</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token module class-name">MyApp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">Resources</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">Message</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    destination_attribute </span><span class="token atom symbol" style="color:#36acaa">:user_id</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    description </span><span class="token string" style="color:#e3116c">&quot;사용자가 보낸 메시지&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># 다대일 관계</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  belongs_to </span><span class="token atom symbol" style="color:#36acaa">:organization</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token module class-name">MyApp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">Resources</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">Organization</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    allow_nil? </span><span class="token boolean" style="color:#36acaa">false</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># 필수 관계</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    attribute_constraints </span><span class="token attr-name" style="color:#00a4db">on_delete:</span><span class="token plain"> </span><span class="token atom symbol" style="color:#36acaa">:delete_all</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># 소유 관계</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    description </span><span class="token string" style="color:#e3116c">&quot;사용자가 속한 조직&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># 일대일 관계</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  has_one </span><span class="token atom symbol" style="color:#36acaa">:profile</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token module class-name">MyApp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">Resources</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">Profile</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    destination_attribute </span><span class="token atom symbol" style="color:#36acaa">:user_id</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    description </span><span class="token string" style="color:#e3116c">&quot;사용자 프로필&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># 다대다 관계</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  many_to_many </span><span class="token atom symbol" style="color:#36acaa">:projects</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token module class-name">MyApp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">Resources</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">Project</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    through </span><span class="token module class-name">MyApp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">Resources</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">ProjectMember</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    source_attribute_on_join_resource </span><span class="token atom symbol" style="color:#36acaa">:user_id</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    destination_attribute_on_join_resource </span><span class="token atom symbol" style="color:#36acaa">:project_id</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    description </span><span class="token string" style="color:#e3116c">&quot;사용자가 참여하는 프로젝트&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">end</span><br></span></code></pre><div class="buttonGroup_Y8nk"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_FM2O" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_GhTt"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_AhUB"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_QJwc" id="관계-정의-규칙">관계 정의 규칙<a href="#관계-정의-규칙" class="hash-link" aria-label="Direct link to 관계 정의 규칙" title="Direct link to 관계 정의 규칙">​</a></h4>
<ol>
<li><strong>관계 유형</strong>: 정확한 관계 유형(<code>has_many</code>, <code>belongs_to</code>, <code>has_one</code>, <code>many_to_many</code>)을 선택합니다.</li>
<li><strong>속성 명명</strong>: 기본 외래 키 이름은 <code>{관계명}_id</code>입니다. 다른 이름을 사용할 경우 <code>source_attribute</code> 또는 <code>destination_attribute</code>를 명시합니다.</li>
<li><strong>무결성 제약 조건</strong>: <code>on_delete</code>, <code>on_update</code> 정책을 명확히 설정합니다.</li>
<li><strong>필수 관계</strong>: 필수 관계는 <code>allow_nil? false</code>로 설정합니다.</li>
<li><strong>설명</strong>: 각 관계의 의미를 <code>description</code>에 명시합니다.</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_QJwc" id="24-계산-및-집계-정의">2.4 계산 및 집계 정의<a href="#24-계산-및-집계-정의" class="hash-link" aria-label="Direct link to 2.4 계산 및 집계 정의" title="Direct link to 2.4 계산 및 집계 정의">​</a></h3>
<p>계산된 속성과 집계는 리소스의 데이터를 기반으로 동적으로 계산된 값을 정의합니다:</p>
<div class="language-elixir codeBlockContainer_qNdj theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_enjf"><pre tabindex="0" class="prism-code language-elixir codeBlock_txiP thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_XHAo"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># 계산된 속성</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">calculations </span><span class="token keyword" style="color:#00009f">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># 간단한 계산</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  calculate </span><span class="token atom symbol" style="color:#36acaa">:full_name</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token atom symbol" style="color:#36acaa">:string</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">expr</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">first_name </span><span class="token operator" style="color:#393A34">&lt;&gt;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot; &quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;&gt;</span><span class="token plain"> last_name</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># 조건부 계산</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  calculate </span><span class="token atom symbol" style="color:#36acaa">:subscription_status_text</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token atom symbol" style="color:#36acaa">:string</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">expr</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">case</span><span class="token plain"> subscription_status </span><span class="token keyword" style="color:#00009f">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;활성&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;대기 중&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;만료됨&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      _ </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;알 수 없음&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># 관계를 사용한 계산</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  calculate </span><span class="token atom symbol" style="color:#36acaa">:has_messages</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token atom symbol" style="color:#36acaa">:boolean</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">expr</span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">count</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">messages</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 집계 정의</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">aggregates </span><span class="token keyword" style="color:#00009f">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># 단순 카운트</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  count </span><span class="token atom symbol" style="color:#36acaa">:message_count</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token atom symbol" style="color:#36acaa">:messages</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># 합계</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  sum </span><span class="token atom symbol" style="color:#36acaa">:total_purchases</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token atom symbol" style="color:#36acaa">:orders</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token atom symbol" style="color:#36acaa">:amount</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># 평균</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  average </span><span class="token atom symbol" style="color:#36acaa">:average_rating</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token atom symbol" style="color:#36acaa">:reviews</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token atom symbol" style="color:#36acaa">:rating</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># 최소/최대</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  max </span><span class="token atom symbol" style="color:#36acaa">:last_login</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token atom symbol" style="color:#36acaa">:login_events</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token atom symbol" style="color:#36acaa">:timestamp</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  min </span><span class="token atom symbol" style="color:#36acaa">:first_login</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token atom symbol" style="color:#36acaa">:login_events</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token atom symbol" style="color:#36acaa">:timestamp</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">end</span><br></span></code></pre><div class="buttonGroup_Y8nk"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_FM2O" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_GhTt"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_AhUB"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_QJwc" id="계산-및-집계-규칙">계산 및 집계 규칙<a href="#계산-및-집계-규칙" class="hash-link" aria-label="Direct link to 계산 및 집계 규칙" title="Direct link to 계산 및 집계 규칙">​</a></h4>
<ol>
<li><strong>표현식 사용</strong>: 계산된 속성은 <code>expr/1</code> 매크로를 사용하여 정의합니다.</li>
<li><strong>성능 고려</strong>: 복잡한 계산은 성능에 영향을 줄 수 있으므로 최적화합니다.</li>
<li><strong>명시적 로딩</strong>: 계산 및 집계를 사용하기 전에 <code>Ash.Query.load/2</code>로 명시적으로 로드합니다.</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_QJwc" id="3-ash-확장-모듈-활용-가이드">3. Ash 확장 모듈 활용 가이드<a href="#3-ash-확장-모듈-활용-가이드" class="hash-link" aria-label="Direct link to 3. Ash 확장 모듈 활용 가이드" title="Direct link to 3. Ash 확장 모듈 활용 가이드">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_QJwc" id="31-ashstatemachine">3.1 AshStateMachine<a href="#31-ashstatemachine" class="hash-link" aria-label="Direct link to 3.1 AshStateMachine" title="Direct link to 3.1 AshStateMachine">​</a></h3>
<p>상태 전이 관리를 위한 확장 모듈입니다:</p>
<div class="language-elixir codeBlockContainer_qNdj theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_enjf"><pre tabindex="0" class="prism-code language-elixir codeBlock_txiP thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_XHAo"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">use</span><span class="token plain"> </span><span class="token module class-name">Ash</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">Resource</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token attr-name" style="color:#00a4db">extensions:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token module class-name">AshStateMachine</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">Resource</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">attributes </span><span class="token keyword" style="color:#00009f">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  attribute </span><span class="token atom symbol" style="color:#36acaa">:status</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token atom symbol" style="color:#36acaa">:atom</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    constraints </span><span class="token punctuation" style="color:#393A34">[</span><span class="token attr-name" style="color:#00a4db">one_of:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token atom symbol" style="color:#36acaa">:pending</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token atom symbol" style="color:#36acaa">:approved</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token atom symbol" style="color:#36acaa">:rejected</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token atom symbol" style="color:#36acaa">:completed</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    default </span><span class="token atom symbol" style="color:#36acaa">:pending</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">state_machine </span><span class="token keyword" style="color:#00009f">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># 상태 필드 지정</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  field </span><span class="token atom symbol" style="color:#36acaa">:status</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># 초기 상태 정의</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  initial_states </span><span class="token punctuation" style="color:#393A34">[</span><span class="token atom symbol" style="color:#36acaa">:pending</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># 상태 전이 규칙</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  transitions </span><span class="token keyword" style="color:#00009f">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    transition </span><span class="token atom symbol" style="color:#36acaa">:approve</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token attr-name" style="color:#00a4db">from:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token atom symbol" style="color:#36acaa">:pending</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token attr-name" style="color:#00a4db">to:</span><span class="token plain"> </span><span class="token atom symbol" style="color:#36acaa">:approved</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    transition </span><span class="token atom symbol" style="color:#36acaa">:reject</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token attr-name" style="color:#00a4db">from:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token atom symbol" style="color:#36acaa">:pending</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token attr-name" style="color:#00a4db">to:</span><span class="token plain"> </span><span class="token atom symbol" style="color:#36acaa">:rejected</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    transition </span><span class="token atom symbol" style="color:#36acaa">:complete</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token attr-name" style="color:#00a4db">from:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token atom symbol" style="color:#36acaa">:approved</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token attr-name" style="color:#00a4db">to:</span><span class="token plain"> </span><span class="token atom symbol" style="color:#36acaa">:completed</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    transition </span><span class="token atom symbol" style="color:#36acaa">:reopen</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token attr-name" style="color:#00a4db">from:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token atom symbol" style="color:#36acaa">:rejected</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token atom symbol" style="color:#36acaa">:completed</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token attr-name" style="color:#00a4db">to:</span><span class="token plain"> </span><span class="token atom symbol" style="color:#36acaa">:pending</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># 전이 전/후 동작 정의</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  on_transition </span><span class="token atom symbol" style="color:#36acaa">:approve</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># 전이 전 검증</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    prevent_transition </span><span class="token attr-name" style="color:#00a4db">unless:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">fn</span><span class="token plain"> changeset</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> _ </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token function" style="color:#d73a49">has_approval_permission?</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">changeset</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># 전이 시 속성 변경</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    set_attribute </span><span class="token atom symbol" style="color:#36acaa">:approved_at</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token module class-name">DateTime</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">utc_now</span><span class="token operator" style="color:#393A34">/</span><span class="token number" style="color:#36acaa">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    set_attribute </span><span class="token atom symbol" style="color:#36acaa">:approver_id</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">fn</span><span class="token plain"> changeset</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> _ </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token module class-name">Ash</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">Changeset</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">get_context</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">changeset</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">actor</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 액션에서 상태 전이 사용</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">actions </span><span class="token keyword" style="color:#00009f">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  update </span><span class="token atom symbol" style="color:#36acaa">:approve</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    accept </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    change </span><span class="token function" style="color:#d73a49">transition_state</span><span class="token punctuation" style="color:#393A34">(</span><span class="token atom symbol" style="color:#36acaa">:approve</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  update </span><span class="token atom symbol" style="color:#36acaa">:reject</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    accept </span><span class="token punctuation" style="color:#393A34">[</span><span class="token atom symbol" style="color:#36acaa">:rejection_reason</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    change </span><span class="token function" style="color:#d73a49">transition_state</span><span class="token punctuation" style="color:#393A34">(</span><span class="token atom symbol" style="color:#36acaa">:reject</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">end</span><br></span></code></pre><div class="buttonGroup_Y8nk"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_FM2O" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_GhTt"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_AhUB"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_QJwc" id="ashstatemachine-모범-사례">AshStateMachine 모범 사례<a href="#ashstatemachine-모범-사례" class="hash-link" aria-label="Direct link to AshStateMachine 모범 사례" title="Direct link to AshStateMachine 모범 사례">​</a></h4>
<ol>
<li><strong>상태 필드</strong>: 상태 필드는 <code>:atom</code> 타입으로 정의하고 유효한 상태 목록을 <code>constraints [one_of: [...]]</code>로 제한합니다.</li>
<li><strong>전이 규칙</strong>: 모든 가능한 상태 전이를 명시적으로 정의합니다.</li>
<li><strong>전이 동작</strong>: 상태 변경 시 추가 동작(타임스탬프 설정, 사용자 기록 등)을 <code>on_transition</code> 블록에 정의합니다.</li>
<li><strong>액션 연결</strong>: 상태 전이를 위한 전용 액션을 정의하고 <code>transition_state/1</code>를 사용합니다.</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_QJwc" id="32-asharchival">3.2 AshArchival<a href="#32-asharchival" class="hash-link" aria-label="Direct link to 3.2 AshArchival" title="Direct link to 3.2 AshArchival">​</a></h3>
<p>논리적 삭제(소프트 삭제)를 위한 확장 모듈입니다:</p>
<div class="language-elixir codeBlockContainer_qNdj theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_enjf"><pre tabindex="0" class="prism-code language-elixir codeBlock_txiP thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_XHAo"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">use</span><span class="token plain"> </span><span class="token module class-name">Ash</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">Resource</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token attr-name" style="color:#00a4db">extensions:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token module class-name">AshArchival</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">Resource</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 아카이브 속성 설정</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">archival </span><span class="token keyword" style="color:#00009f">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># 아카이브 여부를 저장할 속성</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  archive_attribute </span><span class="token atom symbol" style="color:#36acaa">:archived</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># 아카이브 시간을 저장할 속성</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  archive_timestamp_attribute </span><span class="token atom symbol" style="color:#36acaa">:archived_at</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 중요: 아카이브된 레코드를 기본적으로 필터링</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">resource </span><span class="token keyword" style="color:#00009f">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  base_filter? </span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 아카이브/복원 액션</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">actions </span><span class="token keyword" style="color:#00009f">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># 아카이브 액션</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  update </span><span class="token atom symbol" style="color:#36acaa">:archive</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    accept </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    change </span><span class="token function" style="color:#d73a49">archive</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># 복원 액션</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  update </span><span class="token atom symbol" style="color:#36acaa">:unarchive</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    accept </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    change </span><span class="token function" style="color:#d73a49">unarchive</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># 아카이브된 항목 포함 조회</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  read </span><span class="token atom symbol" style="color:#36acaa">:read_with_archived</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    prepare </span><span class="token function" style="color:#d73a49">build</span><span class="token punctuation" style="color:#393A34">(</span><span class="token attr-name" style="color:#00a4db">load:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">end</span><br></span></code></pre><div class="buttonGroup_Y8nk"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_FM2O" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_GhTt"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_AhUB"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_QJwc" id="asharchival-모범-사례">AshArchival 모범 사례<a href="#asharchival-모범-사례" class="hash-link" aria-label="Direct link to AshArchival 모범 사례" title="Direct link to AshArchival 모범 사례">​</a></h4>
<ol>
<li><strong>base_filter 활성화</strong>: 항상 <code>resource do base_filter? true end</code>를 설정하여 아카이브된 레코드가 기본적으로 필터링되도록 합니다.</li>
<li><strong>아카이브 액션</strong>: 명시적인 아카이브/복원 액션을 정의합니다.</li>
<li><strong>아카이브 시간 기록</strong>: <code>archive_timestamp_attribute</code> 설정으로 아카이브 시간을 자동으로 기록합니다.</li>
<li><strong>아카이브 포함 쿼리</strong>: 필요한 경우 아카이브된 항목을 포함한 조회 액션을 별도로 정의합니다.</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_QJwc" id="33-ashpapertrail">3.3 AshPaperTrail<a href="#33-ashpapertrail" class="hash-link" aria-label="Direct link to 3.3 AshPaperTrail" title="Direct link to 3.3 AshPaperTrail">​</a></h3>
<p>변경 이력 추적을 위한 확장 모듈입니다:</p>
<div class="language-elixir codeBlockContainer_qNdj theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_enjf"><pre tabindex="0" class="prism-code language-elixir codeBlock_txiP thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_XHAo"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">use</span><span class="token plain"> </span><span class="token module class-name">Ash</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">Resource</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token attr-name" style="color:#00a4db">extensions:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token module class-name">AshPaperTrail</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">Resource</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 변경 이력 설정</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">paper_trail </span><span class="token keyword" style="color:#00009f">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># 추적할 속성 지정</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  track_attribute </span><span class="token atom symbol" style="color:#36acaa">:status</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  track_attribute </span><span class="token atom symbol" style="color:#36acaa">:assigned_to_id</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># 관계 업데이트 추적</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  track_relationship_updates? </span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># 액터(변경 주체) 추적</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  monitor_actor? </span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  track_actor? </span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># 변경 사유(선택사항)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  track_reason? </span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 액션 설정</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">actions </span><span class="token keyword" style="color:#00009f">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  update </span><span class="token atom symbol" style="color:#36acaa">:assign</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    accept </span><span class="token punctuation" style="color:#393A34">[</span><span class="token atom symbol" style="color:#36acaa">:assigned_to_id</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># 변경 사유 요구</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    argument </span><span class="token atom symbol" style="color:#36acaa">:reason</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token atom symbol" style="color:#36acaa">:string</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      allow_nil? </span><span class="token boolean" style="color:#36acaa">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># 변경 사유 설정</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    change </span><span class="token function" style="color:#d73a49">set_context_attribute</span><span class="token punctuation" style="color:#393A34">(</span><span class="token atom symbol" style="color:#36acaa">:paper_trail_reason</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">fn</span><span class="token plain"> changeset </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token module class-name">Ash</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">Changeset</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">get_argument</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">changeset</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token atom symbol" style="color:#36acaa">:reason</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">end</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">end</span><br></span></code></pre><div class="buttonGroup_Y8nk"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_FM2O" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_GhTt"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_AhUB"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_QJwc" id="ashpapertrail-모범-사례">AshPaperTrail 모범 사례<a href="#ashpapertrail-모범-사례" class="hash-link" aria-label="Direct link to AshPaperTrail 모범 사례" title="Direct link to AshPaperTrail 모범 사례">​</a></h4>
<ol>
<li><strong>추적 대상 선택</strong>: 변경 이력이 필요한 중요 속성만 <code>track_attribute</code>로 지정합니다.</li>
<li><strong>액터 추적</strong>: 변경 주체를 추적하려면 <code>monitor_actor?</code> 및 <code>track_actor?</code>를 활성화합니다.</li>
<li><strong>변경 사유</strong>: 중요한 변경의 경우 <code>track_reason?</code>를 활성화하고 액션에서 변경 사유를 요구합니다.</li>
<li><strong>컨텍스트 활용</strong>: 액션 실행 시 <code>Ash.ContextHelpers.set_actor/2</code>로 액터를 설정합니다.</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_QJwc" id="34-ashoban">3.4 AshOban<a href="#34-ashoban" class="hash-link" aria-label="Direct link to 3.4 AshOban" title="Direct link to 3.4 AshOban">​</a></h3>
<p>비동기 작업 처리를 위한 확장 모듈입니다:</p>
<div class="language-elixir codeBlockContainer_qNdj theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_enjf"><pre tabindex="0" class="prism-code language-elixir codeBlock_txiP thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_XHAo"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">use</span><span class="token plain"> </span><span class="token module class-name">Ash</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">Resource</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token attr-name" style="color:#00a4db">extensions:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token module class-name">AshOban</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">Resource</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Oban 작업 설정</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">oban_job </span><span class="token keyword" style="color:#00009f">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># 큐 이름</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  queue </span><span class="token atom symbol" style="color:#36acaa">:messages</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># 우선순위 (낮을수록 높은 우선순위)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  priority </span><span class="token number" style="color:#36acaa">3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># 최대 재시도 횟수</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  max_attempts </span><span class="token number" style="color:#36acaa">5</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># 고유 작업 식별 (중복 방지)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  unique </span><span class="token punctuation" style="color:#393A34">[</span><span class="token atom symbol" style="color:#36acaa">:message_id</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># 작업 유효 기간</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  max_age </span><span class="token number" style="color:#36acaa">24</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">60</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">60</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># 실행할 워커 지정</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  worker </span><span class="token module class-name">MyApp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">Workers</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">MessageWorker</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># 태그 (분류 및 필터링용)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  tags </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;message&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;notification&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 액션에서 작업 예약</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">actions </span><span class="token keyword" style="color:#00009f">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  create </span><span class="token atom symbol" style="color:#36acaa">:schedule_message</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    accept </span><span class="token punctuation" style="color:#393A34">[</span><span class="token atom symbol" style="color:#36acaa">:title</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token atom symbol" style="color:#36acaa">:body</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token atom symbol" style="color:#36acaa">:recipient_id</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># 예약 시간(선택)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    argument </span><span class="token atom symbol" style="color:#36acaa">:scheduled_at</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token atom symbol" style="color:#36acaa">:utc_datetime</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      allow_nil? </span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Oban 작업으로 실행</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    run_oban_job </span><span class="token keyword" style="color:#00009f">fn</span><span class="token plain"> changeset </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic"># 작업 인자 설정</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      args </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">%</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token attr-name" style="color:#00a4db">message_id:</span><span class="token plain"> </span><span class="token module class-name">Ash</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">Changeset</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">get_context</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">changeset</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token atom symbol" style="color:#36acaa">:message_id</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token attr-name" style="color:#00a4db">recipient_id:</span><span class="token plain"> </span><span class="token module class-name">Ash</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">Changeset</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">get_attribute</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">changeset</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token atom symbol" style="color:#36acaa">:recipient_id</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic"># 예약 시간 설정</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      scheduled_at </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token module class-name">Ash</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">Changeset</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">get_argument</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">changeset</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token atom symbol" style="color:#36acaa">:scheduled_at</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> scheduled_at </span><span class="token keyword" style="color:#00009f">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">{</span><span class="token atom symbol" style="color:#36acaa">:ok</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> args</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token attr-name" style="color:#00a4db">scheduled_at:</span><span class="token plain"> scheduled_at</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">else</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">{</span><span class="token atom symbol" style="color:#36acaa">:ok</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> args</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">end</span><br></span></code></pre><div class="buttonGroup_Y8nk"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_FM2O" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_GhTt"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_AhUB"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_QJwc" id="ashoban-모범-사례">AshOban 모범 사례<a href="#ashoban-모범-사례" class="hash-link" aria-label="Direct link to AshOban 모범 사례" title="Direct link to AshOban 모범 사례">​</a></h4>
<ol>
<li><strong>적절한 큐 선택</strong>: 작업 유형에 맞는 큐를 선택하여 우선순위 및 처리량을 관리합니다.</li>
<li><strong>고유성 관리</strong>: 중복 작업 방지를 위해 <code>unique</code> 파라미터를 설정합니다.</li>
<li><strong>재시도 전략</strong>: 중요 작업은 <code>max_attempts</code>를 높게 설정하고, 일시적 실패 시 지수 백오프 재시도 전략을 구현합니다.</li>
<li><strong>작업 메타데이터</strong>: <code>tags</code>를 사용하여 작업 분류 및 모니터링을 용이하게 합니다.</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_QJwc" id="35-ashcloak">3.5 AshCloak<a href="#35-ashcloak" class="hash-link" aria-label="Direct link to 3.5 AshCloak" title="Direct link to 3.5 AshCloak">​</a></h3>
<p>민감 데이터 암호화를 위한 확장 모듈입니다:</p>
<div class="language-elixir codeBlockContainer_qNdj theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_enjf"><pre tabindex="0" class="prism-code language-elixir codeBlock_txiP thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_XHAo"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">use</span><span class="token plain"> </span><span class="token module class-name">Ash</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">Resource</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token attr-name" style="color:#00a4db">extensions:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token module class-name">AshCloak</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">Resource</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">attributes </span><span class="token keyword" style="color:#00009f">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># 암호화가 필요한 속성</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  attribute </span><span class="token atom symbol" style="color:#36acaa">:email</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token atom symbol" style="color:#36acaa">:string</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token attr-name" style="color:#00a4db">sensitive?:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  attribute </span><span class="token atom symbol" style="color:#36acaa">:phone_number</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token atom symbol" style="color:#36acaa">:string</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token attr-name" style="color:#00a4db">sensitive?:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  attribute </span><span class="token atom symbol" style="color:#36acaa">:api_token</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token atom symbol" style="color:#36acaa">:string</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token attr-name" style="color:#00a4db">sensitive?:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 암호화 설정</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">encrypted_attributes </span><span class="token keyword" style="color:#00009f">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># 암호화할 속성 지정</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  attribute </span><span class="token atom symbol" style="color:#36acaa">:email</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  attribute </span><span class="token atom symbol" style="color:#36acaa">:phone_number</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  attribute </span><span class="token atom symbol" style="color:#36acaa">:api_token</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># 사용할 Vault 지정 (선택사항)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  vault </span><span class="token module class-name">MyApp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">Vault</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">EmailVault</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token attr-name" style="color:#00a4db">for:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token atom symbol" style="color:#36acaa">:email</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  vault </span><span class="token module class-name">MyApp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">Vault</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">PhoneVault</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token attr-name" style="color:#00a4db">for:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token atom symbol" style="color:#36acaa">:phone_number</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  vault </span><span class="token module class-name">MyApp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">Vault</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">TokenVault</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token attr-name" style="color:#00a4db">for:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token atom symbol" style="color:#36acaa">:api_token</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">end</span><br></span></code></pre><div class="buttonGroup_Y8nk"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_FM2O" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_GhTt"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_AhUB"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_QJwc" id="ashcloak-모범-사례">AshCloak 모범 사례<a href="#ashcloak-모범-사례" class="hash-link" aria-label="Direct link to AshCloak 모범 사례" title="Direct link to AshCloak 모범 사례">​</a></h4>
<ol>
<li><strong>민감 데이터 식별</strong>: 개인 식별 정보, 인증 정보, 금융 정보 등 민감한 데이터를 식별하고 <code>sensitive?: true</code>로 표시합니다.</li>
<li><strong>Vault 설정</strong>: 데이터 유형별로 적절한 Vault를 설정합니다.</li>
<li><strong>키 관리</strong>: 암호화 키를 안전하게 관리하고 정기적으로 교체합니다.</li>
</ol>
<div class="language-elixir codeBlockContainer_qNdj theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_enjf"><pre tabindex="0" class="prism-code language-elixir codeBlock_txiP thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_XHAo"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Vault 설정 예시</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">config </span><span class="token atom symbol" style="color:#36acaa">:ash_cloak</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token attr-name" style="color:#00a4db">repo:</span><span class="token plain"> </span><span class="token module class-name">MyApp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">Repo</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">config </span><span class="token atom symbol" style="color:#36acaa">:ash_cloak</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token module class-name">MyApp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">Vault</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">EmailVault</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token attr-name" style="color:#00a4db">keys:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">%</span><span class="token punctuation" style="color:#393A34">{</span><span class="token attr-name" style="color:#00a4db">tag:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;1&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token attr-name" style="color:#00a4db">key:</span><span class="token plain"> </span><span class="token atom symbol" style="color:#36acaa">:base64</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">decode</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;...&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token attr-name" style="color:#00a4db">default:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">]</span><br></span></code></pre><div class="buttonGroup_Y8nk"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_FM2O" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_GhTt"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_AhUB"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_QJwc" id="36-ashmoney-및-ashdoubleentry">3.6 AshMoney 및 AshDoubleEntry<a href="#36-ashmoney-및-ashdoubleentry" class="hash-link" aria-label="Direct link to 3.6 AshMoney 및 AshDoubleEntry" title="Direct link to 3.6 AshMoney 및 AshDoubleEntry">​</a></h3>
<p>통화 처리 및 이중 원장 회계를 위한 확장 모듈입니다:</p>
<div class="language-elixir codeBlockContainer_qNdj theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_enjf"><pre tabindex="0" class="prism-code language-elixir codeBlock_txiP thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_XHAo"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">use</span><span class="token plain"> </span><span class="token module class-name">Ash</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">Resource</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token attr-name" style="color:#00a4db">extensions:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token module class-name">AshMoney</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">Resource</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token module class-name">AshDoubleEntry</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">Resource</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">attributes </span><span class="token keyword" style="color:#00009f">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># 통화 속성</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  attribute </span><span class="token atom symbol" style="color:#36acaa">:price</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token atom symbol" style="color:#36acaa">:money</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  attribute </span><span class="token atom symbol" style="color:#36acaa">:balance</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token atom symbol" style="color:#36acaa">:money</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token attr-name" style="color:#00a4db">default:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 이중 원장 설정</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">double_entry </span><span class="token keyword" style="color:#00009f">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># 계정 정의</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  account </span><span class="token atom symbol" style="color:#36acaa">:balance</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># 연결할 속성</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    change_attribute </span><span class="token atom symbol" style="color:#36acaa">:balance</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># 계정 유형 (금액 증가 방향)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    credit_type </span><span class="token atom symbol" style="color:#36acaa">:increase</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    debit_type </span><span class="token atom symbol" style="color:#36acaa">:decrease</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 액션에서 이중 원장 사용</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">actions </span><span class="token keyword" style="color:#00009f">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># 입금 액션</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  update </span><span class="token atom symbol" style="color:#36acaa">:deposit</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    accept </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># 입금액 인자</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    argument </span><span class="token atom symbol" style="color:#36acaa">:amount</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token atom symbol" style="color:#36acaa">:decimal</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      allow_nil? </span><span class="token boolean" style="color:#36acaa">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      constraints </span><span class="token punctuation" style="color:#393A34">[</span><span class="token attr-name" style="color:#00a4db">greater_than:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># 이중 원장 거래</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    change </span><span class="token function" style="color:#d73a49">double_entry_credit</span><span class="token punctuation" style="color:#393A34">(</span><span class="token atom symbol" style="color:#36acaa">:balance</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic"># 금액 설정</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      amount </span><span class="token keyword" style="color:#00009f">fn</span><span class="token plain"> changeset </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token module class-name">Ash</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">Changeset</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">get_argument</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">changeset</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token atom symbol" style="color:#36acaa">:amount</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic"># 거래 설명</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      description </span><span class="token string" style="color:#e3116c">&quot;사용자 입금&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic"># 메타데이터</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      metadata </span><span class="token keyword" style="color:#00009f">fn</span><span class="token plain"> changeset </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">%</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token attr-name" style="color:#00a4db">user_id:</span><span class="token plain"> </span><span class="token module class-name">Ash</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">Changeset</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">get_attribute</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">changeset</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token atom symbol" style="color:#36acaa">:id</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token attr-name" style="color:#00a4db">method:</span><span class="token plain"> </span><span class="token module class-name">Ash</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">Changeset</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">get_argument</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">changeset</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token atom symbol" style="color:#36acaa">:method</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># 출금 액션</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  update </span><span class="token atom symbol" style="color:#36acaa">:withdraw</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    accept </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># 출금액 인자</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    argument </span><span class="token atom symbol" style="color:#36acaa">:amount</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token atom symbol" style="color:#36acaa">:decimal</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      allow_nil? </span><span class="token boolean" style="color:#36acaa">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      constraints </span><span class="token punctuation" style="color:#393A34">[</span><span class="token attr-name" style="color:#00a4db">greater_than:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># 이중 원장 거래</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    change </span><span class="token function" style="color:#d73a49">double_entry_debit</span><span class="token punctuation" style="color:#393A34">(</span><span class="token atom symbol" style="color:#36acaa">:balance</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic"># 금액 설정</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      amount </span><span class="token keyword" style="color:#00009f">fn</span><span class="token plain"> changeset </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token module class-name">Ash</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">Changeset</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">get_argument</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">changeset</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token atom symbol" style="color:#36acaa">:amount</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic"># 거래 설명</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      description </span><span class="token string" style="color:#e3116c">&quot;사용자 출금&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic"># 메타데이터</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      metadata </span><span class="token keyword" style="color:#00009f">fn</span><span class="token plain"> changeset </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">%</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token attr-name" style="color:#00a4db">user_id:</span><span class="token plain"> </span><span class="token module class-name">Ash</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">Changeset</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">get_attribute</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">changeset</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token atom symbol" style="color:#36acaa">:id</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token attr-name" style="color:#00a4db">method:</span><span class="token plain"> </span><span class="token module class-name">Ash</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">Changeset</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">get_argument</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">changeset</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token atom symbol" style="color:#36acaa">:method</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">end</span><br></span></code></pre><div class="buttonGroup_Y8nk"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_FM2O" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_GhTt"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_AhUB"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_QJwc" id="ashmoney-및-ashdoubleentry-모범-사례">AshMoney 및 AshDoubleEntry 모범 사례<a href="#ashmoney-및-ashdoubleentry-모범-사례" class="hash-link" aria-label="Direct link to AshMoney 및 AshDoubleEntry 모범 사례" title="Direct link to AshMoney 및 AshDoubleEntry 모범 사례">​</a></h4>
<ol>
<li><strong>통화 속성</strong>: 모든 금액 필드는 <code>:money</code> 타입으로 정의합니다.</li>
<li><strong>계정 유형</strong>: 각 계정의 <code>credit_type</code> 및 <code>debit_type</code>을 비즈니스 규칙에 맞게 설정합니다.</li>
<li><strong>거래 메타데이터</strong>: 모든 거래에 충분한 컨텍스트 정보를 메타데이터로 포함합니다.</li>
<li><strong>거래 설명</strong>: 명확한 거래 설명을 제공하여 감사 추적이 용이하도록 합니다.</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_QJwc" id="4-ash-액션-구현-가이드">4. Ash 액션 구현 가이드<a href="#4-ash-액션-구현-가이드" class="hash-link" aria-label="Direct link to 4. Ash 액션 구현 가이드" title="Direct link to 4. Ash 액션 구현 가이드">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_QJwc" id="41-기본-crud-액션">4.1 기본 CRUD 액션<a href="#41-기본-crud-액션" class="hash-link" aria-label="Direct link to 4.1 기본 CRUD 액션" title="Direct link to 4.1 기본 CRUD 액션">​</a></h3>
<div class="language-elixir codeBlockContainer_qNdj theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_enjf"><pre tabindex="0" class="prism-code language-elixir codeBlock_txiP thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_XHAo"><span class="token-line" style="color:#393A34"><span class="token plain">actions </span><span class="token keyword" style="color:#00009f">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># 기본 CRUD 액션 활성화</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  defaults </span><span class="token punctuation" style="color:#393A34">[</span><span class="token atom symbol" style="color:#36acaa">:create</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token atom symbol" style="color:#36acaa">:read</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token atom symbol" style="color:#36acaa">:update</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token atom symbol" style="color:#36acaa">:destroy</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># 부분 활성화도 가능</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># defaults [:create, :read]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">end</span><br></span></code></pre><div class="buttonGroup_Y8nk"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_FM2O" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_GhTt"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_AhUB"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_QJwc" id="42-커스텀-액션-정의">4.2 커스텀 액션 정의<a href="#42-커스텀-액션-정의" class="hash-link" aria-label="Direct link to 4.2 커스텀 액션 정의" title="Direct link to 4.2 커스텀 액션 정의">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_QJwc" id="생성-액션">생성 액션<a href="#생성-액션" class="hash-link" aria-label="Direct link to 생성 액션" title="Direct link to 생성 액션">​</a></h4>
<div class="language-elixir codeBlockContainer_qNdj theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_enjf"><pre tabindex="0" class="prism-code language-elixir codeBlock_txiP thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_XHAo"><span class="token-line" style="color:#393A34"><span class="token plain">actions </span><span class="token keyword" style="color:#00009f">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># 사용자 등록 액션</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  create </span><span class="token atom symbol" style="color:#36acaa">:register</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># 허용할 속성</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    accept </span><span class="token punctuation" style="color:#393A34">[</span><span class="token atom symbol" style="color:#36acaa">:email</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token atom symbol" style="color:#36acaa">:password</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token atom symbol" style="color:#36acaa">:first_name</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token atom symbol" style="color:#36acaa">:last_name</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># 추가 인자</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    argument </span><span class="token atom symbol" style="color:#36acaa">:terms_accepted</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token atom symbol" style="color:#36acaa">:boolean</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      allow_nil? </span><span class="token boolean" style="color:#36acaa">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      constraints </span><span class="token punctuation" style="color:#393A34">[</span><span class="token attr-name" style="color:#00a4db">must_be:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># 유효성 검증</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    validate </span><span class="token function" style="color:#d73a49">confirm</span><span class="token punctuation" style="color:#393A34">(</span><span class="token atom symbol" style="color:#36acaa">:password</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token atom symbol" style="color:#36acaa">:password_confirmation</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    validate </span><span class="token function" style="color:#d73a49">present</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">[</span><span class="token atom symbol" style="color:#36acaa">:email</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token atom symbol" style="color:#36acaa">:password</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># 속성 변경</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    change </span><span class="token function" style="color:#d73a49">set_attribute</span><span class="token punctuation" style="color:#393A34">(</span><span class="token atom symbol" style="color:#36acaa">:role</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token atom symbol" style="color:#36acaa">:user</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    change </span><span class="token function" style="color:#d73a49">set_attribute</span><span class="token punctuation" style="color:#393A34">(</span><span class="token atom symbol" style="color:#36acaa">:status</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token atom symbol" style="color:#36acaa">:pending</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># 비밀번호 해싱</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    change </span><span class="token keyword" style="color:#00009f">fn</span><span class="token plain"> changeset </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      password </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token module class-name">Ash</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">Changeset</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">get_attribute</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">changeset</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token atom symbol" style="color:#36acaa">:password</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      hashed_password </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token module class-name">Bcrypt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">hash_pwd_salt</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">password</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token module class-name">Ash</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">Changeset</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">set_attribute</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">changeset</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token atom symbol" style="color:#36acaa">:password_hash</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> hashed_password</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token operator" style="color:#393A34">|&gt;</span><span class="token plain"> </span><span class="token module class-name">Ash</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">Changeset</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">set_attribute</span><span class="token punctuation" style="color:#393A34">(</span><span class="token atom symbol" style="color:#36acaa">:password</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">nil</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">end</span><br></span></code></pre><div class="buttonGroup_Y8nk"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_FM2O" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_GhTt"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_AhUB"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_QJwc" id="읽기-액션">읽기 액션<a href="#읽기-액션" class="hash-link" aria-label="Direct link to 읽기 액션" title="Direct link to 읽기 액션">​</a></h4>
<div class="language-elixir codeBlockContainer_qNdj theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_enjf"><pre tabindex="0" class="prism-code language-elixir codeBlock_txiP thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_XHAo"><span class="token-line" style="color:#393A34"><span class="token plain">actions </span><span class="token keyword" style="color:#00009f">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># 사용자 검색 액션</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  read </span><span class="token atom symbol" style="color:#36acaa">:search</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># 필터 인자</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    argument </span><span class="token atom symbol" style="color:#36acaa">:query</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token atom symbol" style="color:#36acaa">:string</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      allow_nil? </span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># 필터 적용</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    filter </span><span class="token function" style="color:#d73a49">expr</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token function" style="color:#d73a49">is_nil</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">^</span><span class="token function" style="color:#d73a49">arg</span><span class="token punctuation" style="color:#393A34">(</span><span class="token atom symbol" style="color:#36acaa">:query</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">or</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      first_name ilike </span><span class="token operator" style="color:#393A34">^</span><span class="token string" style="color:#e3116c">&quot;%</span><span class="token string interpolation delimiter punctuation" style="color:#393A34">#{</span><span class="token string interpolation function" style="color:#d73a49">arg</span><span class="token string interpolation punctuation" style="color:#393A34">(</span><span class="token string interpolation atom symbol" style="color:#36acaa">:query</span><span class="token string interpolation punctuation" style="color:#393A34">)</span><span class="token string interpolation delimiter punctuation" style="color:#393A34">}</span><span class="token string" style="color:#e3116c">%&quot;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">or</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      last_name ilike </span><span class="token operator" style="color:#393A34">^</span><span class="token string" style="color:#e3116c">&quot;%</span><span class="token string interpolation delimiter punctuation" style="color:#393A34">#{</span><span class="token string interpolation function" style="color:#d73a49">arg</span><span class="token string interpolation punctuation" style="color:#393A34">(</span><span class="token string interpolation atom symbol" style="color:#36acaa">:query</span><span class="token string interpolation punctuation" style="color:#393A34">)</span><span class="token string interpolation delimiter punctuation" style="color:#393A34">}</span><span class="token string" style="color:#e3116c">%&quot;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">or</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      email </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">^</span><span class="token function" style="color:#d73a49">arg</span><span class="token punctuation" style="color:#393A34">(</span><span class="token atom symbol" style="color:#36acaa">:query</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># 페이지네이션</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pagination </span><span class="token attr-name" style="color:#00a4db">keyset?:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token attr-name" style="color:#00a4db">default_limit:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">20</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># 정렬</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    sort </span><span class="token punctuation" style="color:#393A34">[</span><span class="token atom symbol" style="color:#36acaa">:last_name</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token atom symbol" style="color:#36acaa">:first_name</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># 활성 사용자만 조회</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  read </span><span class="token atom symbol" style="color:#36acaa">:active_users</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    filter </span><span class="token function" style="color:#d73a49">expr</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">status </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token atom symbol" style="color:#36acaa">:active</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">end</span><br></span></code></pre><div class="buttonGroup_Y8nk"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_FM2O" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_GhTt"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_AhUB"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_QJwc" id="업데이트-액션">업데이트 액션<a href="#업데이트-액션" class="hash-link" aria-label="Direct link to 업데이트 액션" title="Direct link to 업데이트 액션">​</a></h4>
<div class="language-elixir codeBlockContainer_qNdj theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_enjf"><pre tabindex="0" class="prism-code language-elixir codeBlock_txiP thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_XHAo"><span class="token-line" style="color:#393A34"><span class="token plain">actions </span><span class="token keyword" style="color:#00009f">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># 프로필 업데이트 액션</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  update </span><span class="token atom symbol" style="color:#36acaa">:update_profile</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># 허용할 속성</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    accept </span><span class="token punctuation" style="color:#393A34">[</span><span class="token atom symbol" style="color:#36acaa">:first_name</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token atom symbol" style="color:#36acaa">:last_name</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token atom symbol" style="color:#36acaa">:bio</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token atom symbol" style="color:#36acaa">:avatar_url</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># 유효성 검증</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    validate </span><span class="token function" style="color:#d73a49">present</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">[</span><span class="token atom symbol" style="color:#36acaa">:first_name</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token atom symbol" style="color:#36acaa">:last_name</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># 현재 사용자만 수정 가능</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    authorize </span><span class="token atom symbol" style="color:#36acaa">:update</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># 비밀번호 변경 액션</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  update </span><span class="token atom symbol" style="color:#36acaa">:change_password</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># 입력 인자</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    argument </span><span class="token atom symbol" style="color:#36acaa">:current_password</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token atom symbol" style="color:#36acaa">:string</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      allow_nil? </span><span class="token boolean" style="color:#36acaa">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    argument </span><span class="token atom symbol" style="color:#36acaa">:new_password</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token atom symbol" style="color:#36acaa">:string</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      allow_nil? </span><span class="token boolean" style="color:#36acaa">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      constraints </span><span class="token punctuation" style="color:#393A34">[</span><span class="token attr-name" style="color:#00a4db">min_length:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">8</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    argument </span><span class="token atom symbol" style="color:#36acaa">:new_password_confirmation</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token atom symbol" style="color:#36acaa">:string</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      allow_nil? </span><span class="token boolean" style="color:#36acaa">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># 유효성 검증</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    validate </span><span class="token function" style="color:#d73a49">confirm</span><span class="token punctuation" style="color:#393A34">(</span><span class="token atom symbol" style="color:#36acaa">:new_password</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token atom symbol" style="color:#36acaa">:new_password_confirmation</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># 현재 비밀번호 확인</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    validate </span><span class="token keyword" style="color:#00009f">fn</span><span class="token plain"> changeset </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      current </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token module class-name">Ash</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">Changeset</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">get_argument</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">changeset</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token atom symbol" style="color:#36acaa">:current_password</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      hash </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token module class-name">Ash</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">Changeset</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">get_attribute</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">changeset</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token atom symbol" style="color:#36acaa">:password_hash</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token module class-name">Bcrypt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">verify_pass</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">current</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> hash</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token atom symbol" style="color:#36acaa">:ok</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">else</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">{</span><span class="token atom symbol" style="color:#36acaa">:error</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token attr-name" style="color:#00a4db">field:</span><span class="token plain"> </span><span class="token atom symbol" style="color:#36acaa">:current_password</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token attr-name" style="color:#00a4db">message:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;현재 비밀번호가 올바르지 않습니다&quot;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># 새 비밀번호 해싱</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    change </span><span class="token keyword" style="color:#00009f">fn</span><span class="token plain"> changeset </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      new_password </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token module class-name">Ash</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">Changeset</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">get_argument</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">changeset</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token atom symbol" style="color:#36acaa">:new_password</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      hashed_password </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token module class-name">Bcrypt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">hash_pwd_salt</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">new_password</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token module class-name">Ash</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">Changeset</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">set_attribute</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">changeset</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token atom symbol" style="color:#36acaa">:password_hash</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> hashed_password</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">end</span><br></span></code></pre><div class="buttonGroup_Y8nk"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_FM2O" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_GhTt"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_AhUB"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_QJwc" id="삭제-액션">삭제 액션<a href="#삭제-액션" class="hash-link" aria-label="Direct link to 삭제 액션" title="Direct link to 삭제 액션">​</a></h4>
<div class="language-elixir codeBlockContainer_qNdj theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_enjf"><pre tabindex="0" class="prism-code language-elixir codeBlock_txiP thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_XHAo"><span class="token-line" style="color:#393A34"><span class="token plain">actions </span><span class="token keyword" style="color:#00009f">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># 계정 삭제 액션</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  destroy </span><span class="token atom symbol" style="color:#36acaa">:delete_account</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># 입력 인자</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    argument </span><span class="token atom symbol" style="color:#36acaa">:confirmation</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token atom symbol" style="color:#36acaa">:string</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      allow_nil? </span><span class="token boolean" style="color:#36acaa">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      constraints </span><span class="token punctuation" style="color:#393A34">[</span><span class="token attr-name" style="color:#00a4db">must_be:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;DELETE&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># 대안으로 아카이브 사용</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    soft? </span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># 실행 전 콜백</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    before_transaction </span><span class="token keyword" style="color:#00009f">fn</span><span class="token plain"> changeset </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic"># 계정 삭제 전 정리 작업</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      user_id </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token module class-name">Ash</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">Changeset</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">get_attribute</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">changeset</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token atom symbol" style="color:#36acaa">:id</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token module class-name">MyApp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">UserCleanupService</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">schedule_cleanup</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">user_id</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">{</span><span class="token atom symbol" style="color:#36acaa">:ok</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> changeset</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">end</span><br></span></code></pre><div class="buttonGroup_Y8nk"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_FM2O" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_GhTt"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_AhUB"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_QJwc" id="43-액션-인자-및-유효성-검사">4.3 액션 인자 및 유효성 검사<a href="#43-액션-인자-및-유효성-검사" class="hash-link" aria-label="Direct link to 4.3 액션 인자 및 유효성 검사" title="Direct link to 4.3 액션 인자 및 유효성 검사">​</a></h3>
<div class="language-elixir codeBlockContainer_qNdj theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_enjf"><pre tabindex="0" class="prism-code language-elixir codeBlock_txiP thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_XHAo"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># 액션 인자 정의</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">argument </span><span class="token atom symbol" style="color:#36acaa">:search_term</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token atom symbol" style="color:#36acaa">:string</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># 필수 여부</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  allow_nil? </span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># 기본값</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  default </span><span class="token string" style="color:#e3116c">&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># 제약 조건</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  constraints </span><span class="token punctuation" style="color:#393A34">[</span><span class="token attr-name" style="color:#00a4db">min_length:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># 설명</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  description </span><span class="token string" style="color:#e3116c">&quot;검색어&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 공통 유효성 검사</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">validate </span><span class="token function" style="color:#d73a49">present</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">[</span><span class="token atom symbol" style="color:#36acaa">:field1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token atom symbol" style="color:#36acaa">:field2</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">validate </span><span class="token function" style="color:#d73a49">confirm</span><span class="token punctuation" style="color:#393A34">(</span><span class="token atom symbol" style="color:#36acaa">:password</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token atom symbol" style="color:#36acaa">:password_confirmation</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">validate </span><span class="token function" style="color:#d73a49">is_unique</span><span class="token punctuation" style="color:#393A34">(</span><span class="token atom symbol" style="color:#36acaa">:email</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">validate </span><span class="token function" style="color:#d73a49">format</span><span class="token punctuation" style="color:#393A34">(</span><span class="token atom symbol" style="color:#36acaa">:email</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token regex" style="color:#36acaa">~r/@/</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">validate </span><span class="token function" style="color:#d73a49">min_length</span><span class="token punctuation" style="color:#393A34">(</span><span class="token atom symbol" style="color:#36acaa">:password</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">8</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">validate </span><span class="token function" style="color:#d73a49">max_length</span><span class="token punctuation" style="color:#393A34">(</span><span class="token atom symbol" style="color:#36acaa">:bio</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">500</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 커스텀 유효성 검사</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">validate </span><span class="token keyword" style="color:#00009f">fn</span><span class="token plain"> changeset </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  field1 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token module class-name">Ash</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">Changeset</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">get_attribute</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">changeset</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token atom symbol" style="color:#36acaa">:field1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  field2 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token module class-name">Ash</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">Changeset</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">get_attribute</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">changeset</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token atom symbol" style="color:#36acaa">:field2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">some_condition?</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">field1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> field2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token atom symbol" style="color:#36acaa">:ok</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">else</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token atom symbol" style="color:#36acaa">:error</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token attr-name" style="color:#00a4db">field:</span><span class="token plain"> </span><span class="token atom symbol" style="color:#36acaa">:field1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token attr-name" style="color:#00a4db">message:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;커스텀 오류 메시지&quot;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">end</span><br></span></code></pre><div class="buttonGroup_Y8nk"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_FM2O" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_GhTt"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_AhUB"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_QJwc" id="44-액션-변경-함수">4.4 액션 변경 함수<a href="#44-액션-변경-함수" class="hash-link" aria-label="Direct link to 4.4 액션 변경 함수" title="Direct link to 4.4 액션 변경 함수">​</a></h3>
<div class="language-elixir codeBlockContainer_qNdj theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_enjf"><pre tabindex="0" class="prism-code language-elixir codeBlock_txiP thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_XHAo"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># 속성 설정</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">change </span><span class="token function" style="color:#d73a49">set_attribute</span><span class="token punctuation" style="color:#393A34">(</span><span class="token atom symbol" style="color:#36acaa">:field</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;value&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 동적 속성 설정</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">change </span><span class="token function" style="color:#d73a49">set_attribute</span><span class="token punctuation" style="color:#393A34">(</span><span class="token atom symbol" style="color:#36acaa">:created_at</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token module class-name">DateTime</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">utc_now</span><span class="token operator" style="color:#393A34">/</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 인자 기반 속성 설정</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">change </span><span class="token function" style="color:#d73a49">set_attribute</span><span class="token punctuation" style="color:#393A34">(</span><span class="token atom symbol" style="color:#36acaa">:field</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">fn</span><span class="token plain"> changeset </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token module class-name">Ash</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">Changeset</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">get_argument</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">changeset</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token atom symbol" style="color:#36acaa">:arg_name</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">end</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 관계 관리</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">change </span><span class="token function" style="color:#d73a49">manage_relationship</span><span class="token punctuation" style="color:#393A34">(</span><span class="token atom symbol" style="color:#36acaa">:posts</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">%</span><span class="token punctuation" style="color:#393A34">{</span><span class="token attr-name" style="color:#00a4db">title:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;새 포스트&quot;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 상태 전이</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">change </span><span class="token function" style="color:#d73a49">transition_state</span><span class="token punctuation" style="color:#393A34">(</span><span class="token atom symbol" style="color:#36acaa">:approve</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 이중 원장 거래</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">change </span><span class="token function" style="color:#d73a49">double_entry_credit</span><span class="token punctuation" style="color:#393A34">(</span><span class="token atom symbol" style="color:#36acaa">:account</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">100</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 커스텀 변경 함수</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">change </span><span class="token keyword" style="color:#00009f">fn</span><span class="token plain"> changeset</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> _ </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># 로직 구현</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  modified_changeset </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">do_something</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">changeset</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  modified_changeset</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">end</span><br></span></code></pre><div class="buttonGroup_Y8nk"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_FM2O" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_GhTt"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_AhUB"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_QJwc" id="5-ash-쿼리-및-데이터-로딩-가이드">5. Ash 쿼리 및 데이터 로딩 가이드<a href="#5-ash-쿼리-및-데이터-로딩-가이드" class="hash-link" aria-label="Direct link to 5. Ash 쿼리 및 데이터 로딩 가이드" title="Direct link to 5. Ash 쿼리 및 데이터 로딩 가이드">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_QJwc" id="51-기본-쿼리-작성">5.1 기본 쿼리 작성<a href="#51-기본-쿼리-작성" class="hash-link" aria-label="Direct link to 5.1 기본 쿼리 작성" title="Direct link to 5.1 기본 쿼리 작성">​</a></h3>
<div class="language-elixir codeBlockContainer_qNdj theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_enjf"><pre tabindex="0" class="prism-code language-elixir codeBlock_txiP thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_XHAo"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># 모든 레코드 조회</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">users </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token module class-name">MyApp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">Accounts</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">User</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">|&gt;</span><span class="token plain"> </span><span class="token module class-name">Ash</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">Query</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">filter</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">status </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token atom symbol" style="color:#36acaa">:active</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">|&gt;</span><span class="token plain"> </span><span class="token module class-name">Ash</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">Query</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">sort</span><span class="token punctuation" style="color:#393A34">(</span><span class="token attr-name" style="color:#00a4db">inserted_at:</span><span class="token plain"> </span><span class="token atom symbol" style="color:#36acaa">:desc</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">|&gt;</span><span class="token plain"> </span><span class="token module class-name">Ash</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">Query</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">limit</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">10</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">|&gt;</span><span class="token plain"> </span><span class="token module class-name">MyApp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">Accounts</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">read!</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 단일 레코드 조회</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">user </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token module class-name">MyApp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">Accounts</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">User</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">|&gt;</span><span class="token plain"> </span><span class="token module class-name">Ash</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">Query</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">filter</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">id </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">^</span><span class="token plain">user_id</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">|&gt;</span><span class="token plain"> </span><span class="token module class-name">Ash</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">Query</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">limit</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">|&gt;</span><span class="token plain"> </span><span class="token module class-name">MyApp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">Accounts</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">read_one!</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 카운트 조회</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">count </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token module class-name">MyApp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">Accounts</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">User</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">|&gt;</span><span class="token plain"> </span><span class="token module class-name">Ash</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">Query</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">filter</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">status </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token atom symbol" style="color:#36acaa">:active</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">|&gt;</span><span class="token plain"> </span><span class="token module class-name">Ash</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">Query</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">count!</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup_Y8nk"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_FM2O" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_GhTt"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_AhUB"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_QJwc" id="52-필터링-표현식">5.2 필터링 표현식<a href="#52-필터링-표현식" class="hash-link" aria-label="Direct link to 5.2 필터링 표현식" title="Direct link to 5.2 필터링 표현식">​</a></h3>
<div class="language-elixir codeBlockContainer_qNdj theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_enjf"><pre tabindex="0" class="prism-code language-elixir codeBlock_txiP thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_XHAo"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># 기본 비교</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token module class-name">Ash</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">Query</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">filter</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">user_resource</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> id </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">^</span><span class="token plain">user_id</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token module class-name">Ash</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">Query</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">filter</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">user_resource</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> age </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">18</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token module class-name">Ash</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">Query</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">filter</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">user_resource</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> status </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> </span><span class="token atom symbol" style="color:#36acaa">:inactive</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 논리 연산</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token module class-name">Ash</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">Query</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">filter</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">user_resource</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> status </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token atom symbol" style="color:#36acaa">:active</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">and</span><span class="token plain"> role </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token atom symbol" style="color:#36acaa">:admin</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token module class-name">Ash</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">Query</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">filter</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">user_resource</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> status </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token atom symbol" style="color:#36acaa">:active</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">or</span><span class="token plain"> status </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token atom symbol" style="color:#36acaa">:pending</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token module class-name">Ash</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">Query</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">filter</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">user_resource</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">not</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">is_nil</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">email</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 컬렉션 연산</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token module class-name">Ash</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">Query</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">filter</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">user_resource</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> role </span><span class="token operator" style="color:#393A34">in</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token atom symbol" style="color:#36acaa">:admin</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token atom symbol" style="color:#36acaa">:moderator</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token module class-name">Ash</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">Query</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">filter</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">user_resource</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token atom symbol" style="color:#36acaa">:admin</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">in</span><span class="token plain"> roles</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 문자열 연산</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token module class-name">Ash</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">Query</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">filter</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">user_resource</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> first_name ilike </span><span class="token operator" style="color:#393A34">^</span><span class="token string" style="color:#e3116c">&quot;john%&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token module class-name">Ash</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">Query</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">filter</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">user_resource</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> email </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> email_address</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 날짜 연산</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token module class-name">Ash</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">Query</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">filter</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">user_resource</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> inserted_at </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">^</span><span class="token plain">one_week_ago</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token module class-name">Ash</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">Query</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">filter</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">user_resource</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">is_nil</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">deleted_at</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 관계 필터</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token module class-name">Ash</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">Query</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">filter</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">user_resource</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">exists</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">posts</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> title ilike </span><span class="token operator" style="color:#393A34">^</span><span class="token string" style="color:#e3116c">&quot;%keyword%&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token module class-name">Ash</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">Query</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">filter</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">user_resource</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">count</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">posts</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup_Y8nk"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_FM2O" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_GhTt"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_AhUB"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_QJwc" id="53-관계-로딩">5.3 관계 로딩<a href="#53-관계-로딩" class="hash-link" aria-label="Direct link to 5.3 관계 로딩" title="Direct link to 5.3 관계 로딩">​</a></h3>
<div class="language-elixir codeBlockContainer_qNdj theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_enjf"><pre tabindex="0" class="prism-code language-elixir codeBlock_txiP thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_XHAo"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># 단일 관계 로드</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">user </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token module class-name">MyApp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">Accounts</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">User</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">|&gt;</span><span class="token plain"> </span><span class="token module class-name">Ash</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">Query</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">filter</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">id </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">^</span><span class="token plain">user_id</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">|&gt;</span><span class="token plain"> </span><span class="token module class-name">Ash</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">Query</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">load</span><span class="token punctuation" style="color:#393A34">(</span><span class="token atom symbol" style="color:#36acaa">:profile</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># has_one 관계</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">|&gt;</span><span class="token plain"> </span><span class="token module class-name">MyApp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">Accounts</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">read_one!</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 다중 관계 로드</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">user </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token module class-name">MyApp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">Accounts</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">User</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">|&gt;</span><span class="token plain"> </span><span class="token module class-name">Ash</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">Query</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">filter</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">id </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">^</span><span class="token plain">user_id</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">|&gt;</span><span class="token plain"> </span><span class="token module class-name">Ash</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">Query</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">load</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">[</span><span class="token atom symbol" style="color:#36acaa">:profile</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token atom symbol" style="color:#36acaa">:posts</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">|&gt;</span><span class="token plain"> </span><span class="token module class-name">MyApp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">Accounts</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">read_one!</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 중첩 관계 로드</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">user </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token module class-name">MyApp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">Accounts</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">User</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">|&gt;</span><span class="token plain"> </span><span class="token module class-name">Ash</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">Query</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">filter</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">id </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">^</span><span class="token plain">user_id</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">|&gt;</span><span class="token plain"> </span><span class="token module class-name">Ash</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">Query</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">load</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">[</span><span class="token attr-name" style="color:#00a4db">posts:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token atom symbol" style="color:#36acaa">:comments</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token atom symbol" style="color:#36acaa">:category</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">|&gt;</span><span class="token plain"> </span><span class="token module class-name">MyApp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">Accounts</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">read_one!</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 관계 필터링</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">user </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token module class-name">MyApp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">Accounts</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">User</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">|&gt;</span><span class="token plain"> </span><span class="token module class-name">Ash</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">Query</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">filter</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">id </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">^</span><span class="token plain">user_id</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">|&gt;</span><span class="token plain"> </span><span class="token module class-name">Ash</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">Query</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">load</span><span class="token punctuation" style="color:#393A34">(</span><span class="token attr-name" style="color:#00a4db">posts:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">fn</span><span class="token plain"> query </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  query</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">|&gt;</span><span class="token plain"> </span><span class="token module class-name">Ash</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">Query</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">filter</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">published </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">|&gt;</span><span class="token plain"> </span><span class="token module class-name">Ash</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">Query</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">sort</span><span class="token punctuation" style="color:#393A34">(</span><span class="token attr-name" style="color:#00a4db">published_at:</span><span class="token plain"> </span><span class="token atom symbol" style="color:#36acaa">:desc</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">|&gt;</span><span class="token plain"> </span><span class="token module class-name">Ash</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">Query</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">limit</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">5</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">end</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">|&gt;</span><span class="token plain"> </span><span class="token module class-name">MyApp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">Accounts</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">read_one!</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup_Y8nk"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_FM2O" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_GhTt"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_AhUB"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_QJwc" id="54-계산-및-집계-로딩">5.4 계산 및 집계 로딩<a href="#54-계산-및-집계-로딩" class="hash-link" aria-label="Direct link to 5.4 계산 및 집계 로딩" title="Direct link to 5.4 계산 및 집계 로딩">​</a></h3>
<div class="language-elixir codeBlockContainer_qNdj theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_enjf"><pre tabindex="0" class="prism-code language-elixir codeBlock_txiP thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_XHAo"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># 계산된 속성 로드</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">users </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token module class-name">MyApp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">Accounts</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">User</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">|&gt;</span><span class="token plain"> </span><span class="token module class-name">Ash</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">Query</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">load</span><span class="token punctuation" style="color:#393A34">(</span><span class="token atom symbol" style="color:#36acaa">:full_name</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># 계산된 속성</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">|&gt;</span><span class="token plain"> </span><span class="token module class-name">MyApp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">Accounts</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">read!</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 집계 로드</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">users </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token module class-name">MyApp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">Accounts</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">User</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">|&gt;</span><span class="token plain"> </span><span class="token module class-name">Ash</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">Query</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">load</span><span class="token punctuation" style="color:#393A34">(</span><span class="token atom symbol" style="color:#36acaa">:post_count</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># 집계</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">|&gt;</span><span class="token plain"> </span><span class="token module class-name">MyApp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">Accounts</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">read!</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 계산된 속성을 기준으로 정렬</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">users </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token module class-name">MyApp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">Accounts</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">User</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">|&gt;</span><span class="token plain"> </span><span class="token module class-name">Ash</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">Query</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">load</span><span class="token punctuation" style="color:#393A34">(</span><span class="token atom symbol" style="color:#36acaa">:full_name</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">|&gt;</span><span class="token plain"> </span><span class="token module class-name">Ash</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">Query</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">sort</span><span class="token punctuation" style="color:#393A34">(</span><span class="token atom symbol" style="color:#36acaa">:full_name</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">|&gt;</span><span class="token plain"> </span><span class="token module class-name">MyApp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">Accounts</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">read!</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 계산된 속성 필터링 (런타임 필터)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">users </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token module class-name">MyApp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">Accounts</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">User</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">|&gt;</span><span class="token plain"> </span><span class="token module class-name">Ash</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">Query</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">load</span><span class="token punctuation" style="color:#393A34">(</span><span class="token atom symbol" style="color:#36acaa">:post_count</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">|&gt;</span><span class="token plain"> </span><span class="token module class-name">MyApp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">Accounts</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">read!</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">|&gt;</span><span class="token plain"> </span><span class="token module class-name">Enum</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">filter</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">fn</span><span class="token plain"> user </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> user</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">post_count </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">end</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup_Y8nk"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_FM2O" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_GhTt"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_AhUB"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_QJwc" id="55-페이지네이션">5.5 페이지네이션<a href="#55-페이지네이션" class="hash-link" aria-label="Direct link to 5.5 페이지네이션" title="Direct link to 5.5 페이지네이션">​</a></h3>
<div class="language-elixir codeBlockContainer_qNdj theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_enjf"><pre tabindex="0" class="prism-code language-elixir codeBlock_txiP thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_XHAo"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># 오프셋 기반 페이지네이션</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">users</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> pagination</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token module class-name">MyApp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">Accounts</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">User</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">|&gt;</span><span class="token plain"> </span><span class="token module class-name">Ash</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">Query</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">sort</span><span class="token punctuation" style="color:#393A34">(</span><span class="token attr-name" style="color:#00a4db">inserted_at:</span><span class="token plain"> </span><span class="token atom symbol" style="color:#36acaa">:desc</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">|&gt;</span><span class="token plain"> </span><span class="token module class-name">Ash</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">Query</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">page</span><span class="token punctuation" style="color:#393A34">(</span><span class="token attr-name" style="color:#00a4db">offset:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token attr-name" style="color:#00a4db">limit:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">20</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">|&gt;</span><span class="token plain"> </span><span class="token module class-name">MyApp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">Accounts</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">read!</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 키셋 기반 페이지네이션 (권장)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">users</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> pagination</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token module class-name">MyApp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">Accounts</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">User</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">|&gt;</span><span class="token plain"> </span><span class="token module class-name">Ash</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">Query</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">sort</span><span class="token punctuation" style="color:#393A34">(</span><span class="token attr-name" style="color:#00a4db">inserted_at:</span><span class="token plain"> </span><span class="token atom symbol" style="color:#36acaa">:desc</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">|&gt;</span><span class="token plain"> </span><span class="token module class-name">Ash</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">Query</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">paginate</span><span class="token punctuation" style="color:#393A34">(</span><span class="token atom symbol" style="color:#36acaa">:keyset</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token attr-name" style="color:#00a4db">limit:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">20</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">|&gt;</span><span class="token plain"> </span><span class="token module class-name">MyApp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">Accounts</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">read!</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 다음 페이지 로드</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">next_users</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> pagination</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token module class-name">MyApp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">Accounts</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">User</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">|&gt;</span><span class="token plain"> </span><span class="token module class-name">Ash</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">Query</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">sort</span><span class="token punctuation" style="color:#393A34">(</span><span class="token attr-name" style="color:#00a4db">inserted_at:</span><span class="token plain"> </span><span class="token atom symbol" style="color:#36acaa">:desc</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">|&gt;</span><span class="token plain"> </span><span class="token module class-name">Ash</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">Query</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">paginate</span><span class="token punctuation" style="color:#393A34">(</span><span class="token atom symbol" style="color:#36acaa">:keyset</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token attr-name" style="color:#00a4db">limit:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">20</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token attr-name" style="color:#00a4db">after:</span><span class="token plain"> pagination</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">after_key</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">|&gt;</span><span class="token plain"> </span><span class="token module class-name">MyApp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">Accounts</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">read!</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 이전 페이지 로드</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">prev_users</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> pagination</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token module class-name">MyApp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">Accounts</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">User</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">|&gt;</span><span class="token plain"> </span><span class="token module class-name">Ash</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">Query</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">sort</span><span class="token punctuation" style="color:#393A34">(</span><span class="token attr-name" style="color:#00a4db">inserted_at:</span><span class="token plain"> </span><span class="token atom symbol" style="color:#36acaa">:desc</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">|&gt;</span><span class="token plain"> </span><span class="token module class-name">Ash</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">Query</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">paginate</span><span class="token punctuation" style="color:#393A34">(</span><span class="token atom symbol" style="color:#36acaa">:keyset</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token attr-name" style="color:#00a4db">limit:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">20</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token attr-name" style="color:#00a4db">before:</span><span class="token plain"> pagination</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">before_key</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">|&gt;</span><span class="token plain"> </span><span class="token module class-name">MyApp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">Accounts</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">read!</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup_Y8nk"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_FM2O" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_GhTt"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_AhUB"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_QJwc" id="56-트랜잭션-및-일괄-처리">5.6 트랜잭션 및 일괄 처리<a href="#56-트랜잭션-및-일괄-처리" class="hash-link" aria-label="Direct link to 5.6 트랜잭션 및 일괄 처리" title="Direct link to 5.6 트랜잭션 및 일괄 처리">​</a></h3>
<div class="language-elixir codeBlockContainer_qNdj theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_enjf"><pre tabindex="0" class="prism-code language-elixir codeBlock_txiP thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_XHAo"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># 트랜잭션 내에서 여러 작업 수행</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token module class-name">Ash</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">transaction</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">fn</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># 사용자 생성</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">{</span><span class="token atom symbol" style="color:#36acaa">:ok</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> user</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token module class-name">MyApp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">Accounts</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">User</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">|&gt;</span><span class="token plain"> </span><span class="token module class-name">Ash</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">Changeset</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">for_create</span><span class="token punctuation" style="color:#393A34">(</span><span class="token atom symbol" style="color:#36acaa">:create</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">%</span><span class="token punctuation" style="color:#393A34">{</span><span class="token attr-name" style="color:#00a4db">email:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;user@example.com&quot;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">|&gt;</span><span class="token plain"> </span><span class="token module class-name">MyApp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">Accounts</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">create!</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># 프로필 생성</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">{</span><span class="token atom symbol" style="color:#36acaa">:ok</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> profile</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token module class-name">MyApp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">Accounts</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">Profile</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">|&gt;</span><span class="token plain"> </span><span class="token module class-name">Ash</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">Changeset</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">for_create</span><span class="token punctuation" style="color:#393A34">(</span><span class="token atom symbol" style="color:#36acaa">:create</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">%</span><span class="token punctuation" style="color:#393A34">{</span><span class="token attr-name" style="color:#00a4db">user_id:</span><span class="token plain"> user</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">id</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token attr-name" style="color:#00a4db">bio:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;...&quot;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">|&gt;</span><span class="token plain"> </span><span class="token module class-name">MyApp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">Accounts</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">create!</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># 초기 설정 생성</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">{</span><span class="token atom symbol" style="color:#36acaa">:ok</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> settings</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token module class-name">MyApp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">Accounts</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">UserSettings</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">|&gt;</span><span class="token plain"> </span><span class="token module class-name">Ash</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">Changeset</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">for_create</span><span class="token punctuation" style="color:#393A34">(</span><span class="token atom symbol" style="color:#36acaa">:create</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">%</span><span class="token punctuation" style="color:#393A34">{</span><span class="token attr-name" style="color:#00a4db">user_id:</span><span class="token plain"> user</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">id</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">|&gt;</span><span class="token plain"> </span><span class="token module class-name">MyApp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">Accounts</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">create!</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">{</span><span class="token atom symbol" style="color:#36acaa">:ok</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">user</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> profile</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> settings</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">end</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 데이터 배치 처리</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">users</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">|&gt;</span><span class="token plain"> </span><span class="token module class-name">Enum</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">chunk_every</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">100</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">|&gt;</span><span class="token plain"> </span><span class="token module class-name">Enum</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">each</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">fn</span><span class="token plain"> batch </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token module class-name">Ash</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">transaction</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">fn</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token module class-name">Enum</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">each</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">batch</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">fn</span><span class="token plain"> user </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      user</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token operator" style="color:#393A34">|&gt;</span><span class="token plain"> </span><span class="token module class-name">Ash</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">Changeset</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">for_update</span><span class="token punctuation" style="color:#393A34">(</span><span class="token atom symbol" style="color:#36acaa">:update</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">%</span><span class="token punctuation" style="color:#393A34">{</span><span class="token attr-name" style="color:#00a4db">status:</span><span class="token plain"> </span><span class="token atom symbol" style="color:#36acaa">:verified</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token operator" style="color:#393A34">|&gt;</span><span class="token plain"> </span><span class="token module class-name">MyApp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">Accounts</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">update!</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">end</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">end</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">end</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup_Y8nk"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_FM2O" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_GhTt"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_AhUB"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_QJwc" id="6-domain-및-api-모듈-구성-가이드">6. Domain 및 API 모듈 구성 가이드<a href="#6-domain-및-api-모듈-구성-가이드" class="hash-link" aria-label="Direct link to 6. Domain 및 API 모듈 구성 가이드" title="Direct link to 6. Domain 및 API 모듈 구성 가이드">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_QJwc" id="61-domain-모듈-정의">6.1 Domain 모듈 정의<a href="#61-domain-모듈-정의" class="hash-link" aria-label="Direct link to 6.1 Domain 모듈 정의" title="Direct link to 6.1 Domain 모듈 정의">​</a></h3>
<div class="language-elixir codeBlockContainer_qNdj theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_enjf"><pre tabindex="0" class="prism-code language-elixir codeBlock_txiP thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_XHAo"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">defmodule</span><span class="token plain"> </span><span class="token module class-name">MyApp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">Accounts</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">use</span><span class="token plain"> </span><span class="token module class-name">Ash</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">Domain</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  resources </span><span class="token keyword" style="color:#00009f">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    resource </span><span class="token module class-name">MyApp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">Accounts</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">User</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    resource </span><span class="token module class-name">MyApp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">Accounts</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">Profile</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    resource </span><span class="token module class-name">MyApp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">Accounts</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">UserSettings</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    resource </span><span class="token module class-name">MyApp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">Accounts</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">LoginEvent</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">defmodule</span><span class="token plain"> </span><span class="token module class-name">MyApp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">Messaging</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">use</span><span class="token plain"> </span><span class="token module class-name">Ash</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">Domain</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  resources </span><span class="token keyword" style="color:#00009f">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    resource </span><span class="token module class-name">MyApp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">Messaging</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">Message</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    resource </span><span class="token module class-name">MyApp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">Messaging</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">Conversation</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    resource </span><span class="token module class-name">MyApp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">Messaging</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">Attachment</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">end</span><br></span></code></pre><div class="buttonGroup_Y8nk"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_FM2O" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_GhTt"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_AhUB"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_QJwc" id="62-api-액션-호출">6.2 API 액션 호출<a href="#62-api-액션-호출" class="hash-link" aria-label="Direct link to 6.2 API 액션 호출" title="Direct link to 6.2 API 액션 호출">​</a></h3>
<div class="language-elixir codeBlockContainer_qNdj theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_enjf"><pre tabindex="0" class="prism-code language-elixir codeBlock_txiP thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_XHAo"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># 생성 액션</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token atom symbol" style="color:#36acaa">:ok</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> user</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token module class-name">MyApp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">Accounts</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">create</span><span class="token punctuation" style="color:#393A34">(</span><span class="token module class-name">User</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">%</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token attr-name" style="color:#00a4db">email:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;user@example.com&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token attr-name" style="color:#00a4db">first_name:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;John&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token attr-name" style="color:#00a4db">last_name:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Doe&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 읽기 액션</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token atom symbol" style="color:#36acaa">:ok</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> users</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token module class-name">MyApp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">Accounts</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">read</span><span class="token punctuation" style="color:#393A34">(</span><span class="token module class-name">User</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token attr-name" style="color:#00a4db">filter:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token attr-name" style="color:#00a4db">status:</span><span class="token plain"> </span><span class="token atom symbol" style="color:#36acaa">:active</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 단일 레코드 읽기</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token atom symbol" style="color:#36acaa">:ok</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> user</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token module class-name">MyApp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">Accounts</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token module class-name">User</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> id</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 업데이트 액션</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token atom symbol" style="color:#36acaa">:ok</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> user</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token module class-name">MyApp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">Accounts</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">update</span><span class="token punctuation" style="color:#393A34">(</span><span class="token module class-name">User</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> id</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">%</span><span class="token punctuation" style="color:#393A34">{</span><span class="token attr-name" style="color:#00a4db">status:</span><span class="token plain"> </span><span class="token atom symbol" style="color:#36acaa">:active</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 삭제 액션</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token atom symbol" style="color:#36acaa">:ok</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> _</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token module class-name">MyApp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">Accounts</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">destroy</span><span class="token punctuation" style="color:#393A34">(</span><span class="token module class-name">User</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> id</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 커스텀 액션 호출</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token atom symbol" style="color:#36acaa">:ok</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> user</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token module class-name">MyApp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">Accounts</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">register</span><span class="token punctuation" style="color:#393A34">(</span><span class="token module class-name">User</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">%</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token attr-name" style="color:#00a4db">email:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;user@example.com&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token attr-name" style="color:#00a4db">password:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;password123&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token attr-name" style="color:#00a4db">password_confirmation:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;password123&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token attr-name" style="color:#00a4db">terms_accepted:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup_Y8nk"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_FM2O" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_GhTt"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_AhUB"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_QJwc" id="63-api-컨텍스트-설정">6.3 API 컨텍스트 설정<a href="#63-api-컨텍스트-설정" class="hash-link" aria-label="Direct link to 6.3 API 컨텍스트 설정" title="Direct link to 6.3 API 컨텍스트 설정">​</a></h3>
<div class="language-elixir codeBlockContainer_qNdj theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_enjf"><pre tabindex="0" class="prism-code language-elixir codeBlock_txiP thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_XHAo"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># 액터(인증된 사용자) 설정</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">context </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">%</span><span class="token punctuation" style="color:#393A34">{</span><span class="token attr-name" style="color:#00a4db">actor:</span><span class="token plain"> current_user</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 인증된 사용자 정보로 액션 호출</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token atom symbol" style="color:#36acaa">:ok</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> message</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token module class-name">MyApp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">Messaging</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">create</span><span class="token punctuation" style="color:#393A34">(</span><span class="token module class-name">Message</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">%</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token attr-name" style="color:#00a4db">body:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Hello&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token attr-name" style="color:#00a4db">recipient_id:</span><span class="token plain"> recipient_id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token attr-name" style="color:#00a4db">context:</span><span class="token plain"> context</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 추가 컨텍스트 정보 설정</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">context </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">%</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token attr-name" style="color:#00a4db">actor:</span><span class="token plain"> current_user</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token attr-name" style="color:#00a4db">tenant:</span><span class="token plain"> tenant_id</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token attr-name" style="color:#00a4db">ip_address:</span><span class="token plain"> client_ip</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 컨텍스트와 함께 액션 호출</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token atom symbol" style="color:#36acaa">:ok</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> user</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token module class-name">MyApp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">Accounts</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">update</span><span class="token punctuation" style="color:#393A34">(</span><span class="token module class-name">User</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> user_id</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">%</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token attr-name" style="color:#00a4db">status:</span><span class="token plain"> </span><span class="token atom symbol" style="color:#36acaa">:verified</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token attr-name" style="color:#00a4db">context:</span><span class="token plain"> context</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup_Y8nk"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_FM2O" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_GhTt"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_AhUB"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_QJwc" id="7-테스트-가이드">7. 테스트 가이드<a href="#7-테스트-가이드" class="hash-link" aria-label="Direct link to 7. 테스트 가이드" title="Direct link to 7. 테스트 가이드">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_QJwc" id="71-기본-리소스-테스트">7.1 기본 리소스 테스트<a href="#71-기본-리소스-테스트" class="hash-link" aria-label="Direct link to 7.1 기본 리소스 테스트" title="Direct link to 7.1 기본 리소스 테스트">​</a></h3>
<div class="language-elixir codeBlockContainer_qNdj theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_enjf"><pre tabindex="0" class="prism-code language-elixir codeBlock_txiP thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_XHAo"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">defmodule</span><span class="token plain"> </span><span class="token module class-name">MyApp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">AccountsTest</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">UserTest</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">use</span><span class="token plain"> </span><span class="token module class-name">MyApp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">DataCase</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">alias</span><span class="token plain"> </span><span class="token module class-name">MyApp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">Accounts</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">alias</span><span class="token plain"> </span><span class="token module class-name">MyApp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">Accounts</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">User</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  describe </span><span class="token string" style="color:#e3116c">&quot;create user&quot;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    test </span><span class="token string" style="color:#e3116c">&quot;creates a user with valid attributes&quot;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      attrs </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">%</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token attr-name" style="color:#00a4db">email:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;test@example.com&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token attr-name" style="color:#00a4db">first_name:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;John&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token attr-name" style="color:#00a4db">last_name:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Doe&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token attr-name" style="color:#00a4db">password:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;password123&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token attr-name" style="color:#00a4db">password_confirmation:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;password123&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      assert </span><span class="token punctuation" style="color:#393A34">{</span><span class="token atom symbol" style="color:#36acaa">:ok</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> user</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token module class-name">Accounts</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">create</span><span class="token punctuation" style="color:#393A34">(</span><span class="token module class-name">User</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> attrs</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      assert user</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">email </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;test@example.com&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      assert user</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">first_name </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;John&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      assert user</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">last_name </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Doe&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    test </span><span class="token string" style="color:#e3116c">&quot;fails with invalid attributes&quot;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      attrs </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">%</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token attr-name" style="color:#00a4db">email:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;invalid-email&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token attr-name" style="color:#00a4db">first_name:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token attr-name" style="color:#00a4db">last_name:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      assert </span><span class="token punctuation" style="color:#393A34">{</span><span class="token atom symbol" style="color:#36acaa">:error</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> changeset</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token module class-name">Accounts</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">create</span><span class="token punctuation" style="color:#393A34">(</span><span class="token module class-name">User</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> attrs</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      assert </span><span class="token function" style="color:#d73a49">errors_on</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">changeset</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">email</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      assert </span><span class="token function" style="color:#d73a49">errors_on</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">changeset</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">first_name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      assert </span><span class="token function" style="color:#d73a49">errors_on</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">changeset</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">last_name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  describe </span><span class="token string" style="color:#e3116c">&quot;register user&quot;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    test </span><span class="token string" style="color:#e3116c">&quot;registers a user with valid attributes&quot;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      attrs </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">%</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token attr-name" style="color:#00a4db">email:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;test@example.com&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token attr-name" style="color:#00a4db">first_name:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;John&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token attr-name" style="color:#00a4db">last_name:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Doe&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token attr-name" style="color:#00a4db">password:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;password123&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token attr-name" style="color:#00a4db">password_confirmation:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;password123&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token attr-name" style="color:#00a4db">terms_accepted:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      assert </span><span class="token punctuation" style="color:#393A34">{</span><span class="token atom symbol" style="color:#36acaa">:ok</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> user</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token module class-name">Accounts</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">register</span><span class="token punctuation" style="color:#393A34">(</span><span class="token module class-name">User</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> attrs</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      assert user</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">status </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token atom symbol" style="color:#36acaa">:pending</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      assert user</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">role </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token atom symbol" style="color:#36acaa">:user</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    test </span><span class="token string" style="color:#e3116c">&quot;fails when terms not accepted&quot;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      attrs </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">%</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token attr-name" style="color:#00a4db">email:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;test@example.com&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token attr-name" style="color:#00a4db">first_name:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;John&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token attr-name" style="color:#00a4db">last_name:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Doe&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token attr-name" style="color:#00a4db">password:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;password123&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token attr-name" style="color:#00a4db">password_confirmation:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;password123&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token attr-name" style="color:#00a4db">terms_accepted:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      assert </span><span class="token punctuation" style="color:#393A34">{</span><span class="token atom symbol" style="color:#36acaa">:error</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> changeset</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token module class-name">Accounts</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">register</span><span class="token punctuation" style="color:#393A34">(</span><span class="token module class-name">User</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> attrs</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      assert </span><span class="token function" style="color:#d73a49">errors_on</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">changeset</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">terms_accepted</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">end</span><br></span></code></pre><div class="buttonGroup_Y8nk"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_FM2O" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_GhTt"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_AhUB"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_QJwc" id="72-관계-테스트">7.2 관계 테스트<a href="#72-관계-테스트" class="hash-link" aria-label="Direct link to 7.2 관계 테스트" title="Direct link to 7.2 관계 테스트">​</a></h3>
<div class="language-elixir codeBlockContainer_qNdj theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_enjf"><pre tabindex="0" class="prism-code language-elixir codeBlock_txiP thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_XHAo"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">defmodule</span><span class="token plain"> </span><span class="token module class-name">MyApp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">AccountsTest</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">ProfileTest</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">use</span><span class="token plain"> </span><span class="token module class-name">MyApp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">DataCase</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">alias</span><span class="token plain"> </span><span class="token module class-name">MyApp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">Accounts</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">alias</span><span class="token plain"> </span><span class="token module class-name">MyApp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">Accounts</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">{</span><span class="token module class-name">User</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token module class-name">Profile</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  setup </span><span class="token keyword" style="color:#00009f">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token atom symbol" style="color:#36acaa">:ok</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> user</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token module class-name">Accounts</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">create</span><span class="token punctuation" style="color:#393A34">(</span><span class="token module class-name">User</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">%</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token attr-name" style="color:#00a4db">email:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;test@example.com&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token attr-name" style="color:#00a4db">first_name:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;John&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token attr-name" style="color:#00a4db">last_name:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Doe&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">%</span><span class="token punctuation" style="color:#393A34">{</span><span class="token attr-name" style="color:#00a4db">user:</span><span class="token plain"> user</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  test </span><span class="token string" style="color:#e3116c">&quot;creates a profile for user&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">%</span><span class="token punctuation" style="color:#393A34">{</span><span class="token attr-name" style="color:#00a4db">user:</span><span class="token plain"> user</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    attrs </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">%</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token attr-name" style="color:#00a4db">user_id:</span><span class="token plain"> user</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">id</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token attr-name" style="color:#00a4db">bio:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Test bio&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token attr-name" style="color:#00a4db">avatar_url:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;https://example.com/avatar.jpg&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    assert </span><span class="token punctuation" style="color:#393A34">{</span><span class="token atom symbol" style="color:#36acaa">:ok</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> profile</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token module class-name">Accounts</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">create</span><span class="token punctuation" style="color:#393A34">(</span><span class="token module class-name">Profile</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> attrs</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    assert profile</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">user_id </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> user</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    assert profile</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">bio </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Test bio&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># 관계 로드 검증</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    user_with_profile </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> user</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">|&gt;</span><span class="token plain"> </span><span class="token module class-name">Ash</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">Query</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">load</span><span class="token punctuation" style="color:#393A34">(</span><span class="token atom symbol" style="color:#36acaa">:profile</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">|&gt;</span><span class="token plain"> </span><span class="token module class-name">Accounts</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">read_one!</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    assert user_with_profile</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">profile</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">id </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> profile</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">end</span><br></span></code></pre><div class="buttonGroup_Y8nk"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_FM2O" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_GhTt"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_AhUB"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_QJwc" id="73-액션-테스트">7.3 액션 테스트<a href="#73-액션-테스트" class="hash-link" aria-label="Direct link to 7.3 액션 테스트" title="Direct link to 7.3 액션 테스트">​</a></h3>
<div class="language-elixir codeBlockContainer_qNdj theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_enjf"><pre tabindex="0" class="prism-code language-elixir codeBlock_txiP thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_XHAo"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">defmodule</span><span class="token plain"> </span><span class="token module class-name">MyApp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">AccountsTest</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">UserActionsTest</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">use</span><span class="token plain"> </span><span class="token module class-name">MyApp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">DataCase</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">alias</span><span class="token plain"> </span><span class="token module class-name">MyApp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">Accounts</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">alias</span><span class="token plain"> </span><span class="token module class-name">MyApp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">Accounts</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">User</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  setup </span><span class="token keyword" style="color:#00009f">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token atom symbol" style="color:#36acaa">:ok</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> user</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token module class-name">Accounts</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">create</span><span class="token punctuation" style="color:#393A34">(</span><span class="token module class-name">User</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">%</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token attr-name" style="color:#00a4db">email:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;test@example.com&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token attr-name" style="color:#00a4db">first_name:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;John&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token attr-name" style="color:#00a4db">last_name:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Doe&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token attr-name" style="color:#00a4db">status:</span><span class="token plain"> </span><span class="token atom symbol" style="color:#36acaa">:active</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token attr-name" style="color:#00a4db">password_hash:</span><span class="token plain"> </span><span class="token module class-name">Bcrypt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">hash_pwd_salt</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;password123&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">%</span><span class="token punctuation" style="color:#393A34">{</span><span class="token attr-name" style="color:#00a4db">user:</span><span class="token plain"> user</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  describe </span><span class="token string" style="color:#e3116c">&quot;change_password action&quot;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    test </span><span class="token string" style="color:#e3116c">&quot;changes password with valid input&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">%</span><span class="token punctuation" style="color:#393A34">{</span><span class="token attr-name" style="color:#00a4db">user:</span><span class="token plain"> user</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      params </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">%</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token attr-name" style="color:#00a4db">current_password:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;password123&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token attr-name" style="color:#00a4db">new_password:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;newpassword456&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token attr-name" style="color:#00a4db">new_password_confirmation:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;newpassword456&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      assert </span><span class="token punctuation" style="color:#393A34">{</span><span class="token atom symbol" style="color:#36acaa">:ok</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> updated_user</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token module class-name">Accounts</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">change_password</span><span class="token punctuation" style="color:#393A34">(</span><span class="token module class-name">User</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> user</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">id</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> params</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic"># 비밀번호가 변경되었는지 확인</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      assert </span><span class="token module class-name">Bcrypt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">verify_pass</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;newpassword456&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> updated_user</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">password_hash</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    test </span><span class="token string" style="color:#e3116c">&quot;fails with incorrect current password&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">%</span><span class="token punctuation" style="color:#393A34">{</span><span class="token attr-name" style="color:#00a4db">user:</span><span class="token plain"> user</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      params </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">%</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token attr-name" style="color:#00a4db">current_password:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;wrongpassword&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token attr-name" style="color:#00a4db">new_password:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;newpassword456&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token attr-name" style="color:#00a4db">new_password_confirmation:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;newpassword456&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      assert </span><span class="token punctuation" style="color:#393A34">{</span><span class="token atom symbol" style="color:#36acaa">:error</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> changeset</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token module class-name">Accounts</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">change_password</span><span class="token punctuation" style="color:#393A34">(</span><span class="token module class-name">User</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> user</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">id</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> params</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      assert </span><span class="token function" style="color:#d73a49">errors_on</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">changeset</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">current_password</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    test </span><span class="token string" style="color:#e3116c">&quot;fails with password confirmation mismatch&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">%</span><span class="token punctuation" style="color:#393A34">{</span><span class="token attr-name" style="color:#00a4db">user:</span><span class="token plain"> user</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      params </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">%</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token attr-name" style="color:#00a4db">current_password:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;password123&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token attr-name" style="color:#00a4db">new_password:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;newpassword456&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token attr-name" style="color:#00a4db">new_password_confirmation:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;different&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      assert </span><span class="token punctuation" style="color:#393A34">{</span><span class="token atom symbol" style="color:#36acaa">:error</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> changeset</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token module class-name">Accounts</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">change_password</span><span class="token punctuation" style="color:#393A34">(</span><span class="token module class-name">User</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> user</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">id</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> params</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      assert </span><span class="token function" style="color:#d73a49">errors_on</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">changeset</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">new_password_confirmation</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">end</span><br></span></code></pre><div class="buttonGroup_Y8nk"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_FM2O" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_GhTt"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_AhUB"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_QJwc" id="74-쿼리-테스트">7.4 쿼리 테스트<a href="#74-쿼리-테스트" class="hash-link" aria-label="Direct link to 7.4 쿼리 테스트" title="Direct link to 7.4 쿼리 테스트">​</a></h3>
<div class="language-elixir codeBlockContainer_qNdj theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_enjf"><pre tabindex="0" class="prism-code language-elixir codeBlock_txiP thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_XHAo"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">defmodule</span><span class="token plain"> </span><span class="token module class-name">MyApp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">AccountsTest</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">UserQueriesTest</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">use</span><span class="token plain"> </span><span class="token module class-name">MyApp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">DataCase</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">alias</span><span class="token plain"> </span><span class="token module class-name">MyApp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">Accounts</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">alias</span><span class="token plain"> </span><span class="token module class-name">MyApp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">Accounts</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">User</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  setup </span><span class="token keyword" style="color:#00009f">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># 테스트 데이터 생성</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token atom symbol" style="color:#36acaa">:ok</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> _</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token module class-name">Accounts</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">create</span><span class="token punctuation" style="color:#393A34">(</span><span class="token module class-name">User</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">%</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token attr-name" style="color:#00a4db">email:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;admin@example.com&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token attr-name" style="color:#00a4db">first_name:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Admin&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token attr-name" style="color:#00a4db">last_name:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;User&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token attr-name" style="color:#00a4db">status:</span><span class="token plain"> </span><span class="token atom symbol" style="color:#36acaa">:active</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token attr-name" style="color:#00a4db">role:</span><span class="token plain"> </span><span class="token atom symbol" style="color:#36acaa">:admin</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token atom symbol" style="color:#36acaa">:ok</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> _</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token module class-name">Accounts</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">create</span><span class="token punctuation" style="color:#393A34">(</span><span class="token module class-name">User</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">%</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token attr-name" style="color:#00a4db">email:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;inactive@example.com&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token attr-name" style="color:#00a4db">first_name:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Inactive&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token attr-name" style="color:#00a4db">last_name:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;User&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token attr-name" style="color:#00a4db">status:</span><span class="token plain"> </span><span class="token atom symbol" style="color:#36acaa">:inactive</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token attr-name" style="color:#00a4db">role:</span><span class="token plain"> </span><span class="token atom symbol" style="color:#36acaa">:user</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34">&lt;-</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token operator" style="color:#393A34">..</span><span class="token number" style="color:#36acaa">5</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">{</span><span class="token atom symbol" style="color:#36acaa">:ok</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> _</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token module class-name">Accounts</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">create</span><span class="token punctuation" style="color:#393A34">(</span><span class="token module class-name">User</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">%</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token attr-name" style="color:#00a4db">email:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;user</span><span class="token string interpolation delimiter punctuation" style="color:#393A34">#{</span><span class="token string interpolation" style="color:#e3116c">i</span><span class="token string interpolation delimiter punctuation" style="color:#393A34">}</span><span class="token string" style="color:#e3116c">@example.com&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token attr-name" style="color:#00a4db">first_name:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;User&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token attr-name" style="color:#00a4db">last_name:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string interpolation delimiter punctuation" style="color:#393A34">#{</span><span class="token string interpolation" style="color:#e3116c">i</span><span class="token string interpolation delimiter punctuation" style="color:#393A34">}</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token attr-name" style="color:#00a4db">status:</span><span class="token plain"> </span><span class="token atom symbol" style="color:#36acaa">:active</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token attr-name" style="color:#00a4db">role:</span><span class="token plain"> </span><span class="token atom symbol" style="color:#36acaa">:user</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token atom symbol" style="color:#36acaa">:ok</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  test </span><span class="token string" style="color:#e3116c">&quot;filters active users&quot;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    query </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token module class-name">User</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">|&gt;</span><span class="token plain"> </span><span class="token module class-name">Ash</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">Query</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">filter</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">status </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token atom symbol" style="color:#36acaa">:active</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">|&gt;</span><span class="token plain"> </span><span class="token module class-name">Ash</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">Query</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">sort</span><span class="token punctuation" style="color:#393A34">(</span><span class="token attr-name" style="color:#00a4db">email:</span><span class="token plain"> </span><span class="token atom symbol" style="color:#36acaa">:asc</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    assert </span><span class="token punctuation" style="color:#393A34">{</span><span class="token atom symbol" style="color:#36acaa">:ok</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> users</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token module class-name">Accounts</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">read</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">query</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    assert </span><span class="token function" style="color:#d73a49">length</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">users</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">6</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    assert </span><span class="token module class-name">Enum</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">all?</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">users</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token argument variable" style="color:#36acaa">&amp;1</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">status </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token atom symbol" style="color:#36acaa">:active</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  test </span><span class="token string" style="color:#e3116c">&quot;searches users by name&quot;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    query </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token module class-name">User</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">|&gt;</span><span class="token plain"> </span><span class="token module class-name">Ash</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">Query</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">filter</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">first_name </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Admin&quot;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">or</span><span class="token plain"> first_name </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Inactive&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">|&gt;</span><span class="token plain"> </span><span class="token module class-name">Ash</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">Query</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">sort</span><span class="token punctuation" style="color:#393A34">(</span><span class="token attr-name" style="color:#00a4db">email:</span><span class="token plain"> </span><span class="token atom symbol" style="color:#36acaa">:asc</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    assert </span><span class="token punctuation" style="color:#393A34">{</span><span class="token atom symbol" style="color:#36acaa">:ok</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> users</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token module class-name">Accounts</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">read</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">query</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    assert </span><span class="token function" style="color:#d73a49">length</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">users</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    assert </span><span class="token module class-name">Enum</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">map</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">users</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain"> </span><span class="token argument variable" style="color:#36acaa">&amp;1</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">first_name</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;Admin&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Inactive&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  test </span><span class="token string" style="color:#e3116c">&quot;paginates results&quot;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    query </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token module class-name">User</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">|&gt;</span><span class="token plain"> </span><span class="token module class-name">Ash</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">Query</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">filter</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">role </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token atom symbol" style="color:#36acaa">:user</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">|&gt;</span><span class="token plain"> </span><span class="token module class-name">Ash</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">Query</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">sort</span><span class="token punctuation" style="color:#393A34">(</span><span class="token attr-name" style="color:#00a4db">email:</span><span class="token plain"> </span><span class="token atom symbol" style="color:#36acaa">:asc</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">|&gt;</span><span class="token plain"> </span><span class="token module class-name">Ash</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">Query</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">page</span><span class="token punctuation" style="color:#393A34">(</span><span class="token attr-name" style="color:#00a4db">limit:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token attr-name" style="color:#00a4db">offset:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    assert </span><span class="token punctuation" style="color:#393A34">{</span><span class="token atom symbol" style="color:#36acaa">:ok</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">users</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> pagination</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token module class-name">Accounts</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">read</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">query</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    assert </span><span class="token function" style="color:#d73a49">length</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">users</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    assert pagination</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">count </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">6</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    assert pagination</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">limit </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    assert pagination</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">offset </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">end</span><br></span></code></pre><div class="buttonGroup_Y8nk"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_FM2O" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_GhTt"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_AhUB"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_QJwc" id="8-성능-최적화-팁">8. 성능 최적화 팁<a href="#8-성능-최적화-팁" class="hash-link" aria-label="Direct link to 8. 성능 최적화 팁" title="Direct link to 8. 성능 최적화 팁">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_QJwc" id="81-데이터-로딩-최적화">8.1 데이터 로딩 최적화<a href="#81-데이터-로딩-최적화" class="hash-link" aria-label="Direct link to 8.1 데이터 로딩 최적화" title="Direct link to 8.1 데이터 로딩 최적화">​</a></h3>
<ol>
<li>
<p><strong>필요한 데이터만 로드</strong>: 필요한 속성과 관계만 명시적으로 로드합니다.</p>
<div class="language-elixir codeBlockContainer_qNdj theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_enjf"><pre tabindex="0" class="prism-code language-elixir codeBlock_txiP thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_XHAo"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># 특정 필드만 선택</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token module class-name">User</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">|&gt;</span><span class="token plain"> </span><span class="token module class-name">Ash</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">Query</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">select</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">[</span><span class="token atom symbol" style="color:#36acaa">:id</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token atom symbol" style="color:#36acaa">:email</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token atom symbol" style="color:#36acaa">:first_name</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token atom symbol" style="color:#36acaa">:last_name</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">|&gt;</span><span class="token plain"> </span><span class="token module class-name">Ash</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">Query</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">load</span><span class="token punctuation" style="color:#393A34">(</span><span class="token atom symbol" style="color:#36acaa">:profile</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup_Y8nk"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_FM2O" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_GhTt"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_AhUB"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
<li>
<p><strong>N+1 문제 방지</strong>: 관계를 미리 로드하여 N+1 쿼리 문제를 방지합니다.</p>
<div class="language-elixir codeBlockContainer_qNdj theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_enjf"><pre tabindex="0" class="prism-code language-elixir codeBlock_txiP thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_XHAo"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># 모든 관계를 미리 로드</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">posts </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token module class-name">Post</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">|&gt;</span><span class="token plain"> </span><span class="token module class-name">Ash</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">Query</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">load</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">[</span><span class="token atom symbol" style="color:#36acaa">:author</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token attr-name" style="color:#00a4db">comments:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token atom symbol" style="color:#36acaa">:author</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">|&gt;</span><span class="token plain"> </span><span class="token module class-name">MyApp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">Blog</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">read!</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup_Y8nk"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_FM2O" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_GhTt"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_AhUB"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
<li>
<p><strong>배치 로딩</strong>: 대량 데이터는 배치로 처리합니다.</p>
<div class="language-elixir codeBlockContainer_qNdj theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_enjf"><pre tabindex="0" class="prism-code language-elixir codeBlock_txiP thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_XHAo"><span class="token-line" style="color:#393A34"><span class="token module class-name">Stream</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">resource</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">fn</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">end</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">fn</span><span class="token plain"> offset </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    query </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token module class-name">User</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">|&gt;</span><span class="token plain"> </span><span class="token module class-name">Ash</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">Query</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">sort</span><span class="token punctuation" style="color:#393A34">(</span><span class="token attr-name" style="color:#00a4db">id:</span><span class="token plain"> </span><span class="token atom symbol" style="color:#36acaa">:asc</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">|&gt;</span><span class="token plain"> </span><span class="token module class-name">Ash</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">Query</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">page</span><span class="token punctuation" style="color:#393A34">(</span><span class="token attr-name" style="color:#00a4db">limit:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">100</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token attr-name" style="color:#00a4db">offset:</span><span class="token plain"> offset</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">case</span><span class="token plain"> </span><span class="token module class-name">MyApp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">Accounts</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">read</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">query</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">{</span><span class="token atom symbol" style="color:#36acaa">:ok</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> _</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token atom symbol" style="color:#36acaa">:halt</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">nil</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">{</span><span class="token atom symbol" style="color:#36acaa">:ok</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">users</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> _</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">users</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> offset </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">100</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      _ </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token atom symbol" style="color:#36acaa">:halt</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">nil</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">end</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">fn</span><span class="token plain"> _ </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token atom symbol" style="color:#36acaa">:ok</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">|&gt;</span><span class="token plain"> </span><span class="token module class-name">Stream</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">flat_map</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain"> </span><span class="token argument variable" style="color:#36acaa">&amp;1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">|&gt;</span><span class="token plain"> </span><span class="token module class-name">Stream</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">each</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">fn</span><span class="token plain"> user </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">process_user</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">user</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">end</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">|&gt;</span><span class="token plain"> </span><span class="token module class-name">Stream</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">run</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup_Y8nk"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_FM2O" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_GhTt"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_AhUB"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_QJwc" id="82-쿼리-최적화">8.2 쿼리 최적화<a href="#82-쿼리-최적화" class="hash-link" aria-label="Direct link to 8.2 쿼리 최적화" title="Direct link to 8.2 쿼리 최적화">​</a></h3>
<ol>
<li>
<p><strong>인덱스 활용</strong>: 자주 필터링하는 필드에 인덱스를 생성합니다.</p>
<div class="language-elixir codeBlockContainer_qNdj theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_enjf"><pre tabindex="0" class="prism-code language-elixir codeBlock_txiP thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_XHAo"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># PostgreSQL 인덱스 설정</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">postgres </span><span class="token keyword" style="color:#00009f">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  index </span><span class="token punctuation" style="color:#393A34">[</span><span class="token atom symbol" style="color:#36acaa">:email</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token attr-name" style="color:#00a4db">unique:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  index </span><span class="token punctuation" style="color:#393A34">[</span><span class="token atom symbol" style="color:#36acaa">:status</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token atom symbol" style="color:#36acaa">:role</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  index </span><span class="token punctuation" style="color:#393A34">[</span><span class="token atom symbol" style="color:#36acaa">:last_name</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token atom symbol" style="color:#36acaa">:first_name</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">end</span><br></span></code></pre><div class="buttonGroup_Y8nk"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_FM2O" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_GhTt"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_AhUB"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
<li>
<p><strong>복합 쿼리 최적화</strong>: 복잡한 쿼리는 데이터베이스 수준에서 최적화합니다.</p>
<div class="language-elixir codeBlockContainer_qNdj theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_enjf"><pre tabindex="0" class="prism-code language-elixir codeBlock_txiP thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_XHAo"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># 커스텀 쿼리 사용</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">read </span><span class="token atom symbol" style="color:#36acaa">:complex_search</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  prepare </span><span class="token function" style="color:#d73a49">build</span><span class="token punctuation" style="color:#393A34">(</span><span class="token attr-name" style="color:#00a4db">load:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  argument </span><span class="token atom symbol" style="color:#36acaa">:query</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token atom symbol" style="color:#36acaa">:string</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  manual </span><span class="token keyword" style="color:#00009f">fn</span><span class="token plain"> _query</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">%</span><span class="token punctuation" style="color:#393A34">{</span><span class="token attr-name" style="color:#00a4db">query:</span><span class="token plain"> query</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> _context </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    sql </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    SELECT * FROM users</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    WHERE to_tsvector(&#x27;english&#x27;, first_name || &#x27; &#x27; || last_name || &#x27; &#x27; || email) @@ plainto_tsquery(&#x27;english&#x27;, $1)</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    ORDER BY last_name, first_name</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    LIMIT 20</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    &quot;&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># SQL 실행 (예시)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token atom symbol" style="color:#36acaa">:ok</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> results</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token module class-name">MyApp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">Repo</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">query</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">sql</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">query</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># 결과를 Ash 리소스로 변환</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">end</span><br></span></code></pre><div class="buttonGroup_Y8nk"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_FM2O" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_GhTt"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_AhUB"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
<li>
<p><strong>부분 인덱스</strong>: 특정 조건에만 인덱스를 적용하여 성능을 최적화합니다.</p>
<div class="language-elixir codeBlockContainer_qNdj theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_enjf"><pre tabindex="0" class="prism-code language-elixir codeBlock_txiP thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_XHAo"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># 부분 인덱스 예시</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">postgres </span><span class="token keyword" style="color:#00009f">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  index </span><span class="token punctuation" style="color:#393A34">[</span><span class="token atom symbol" style="color:#36acaa">:status</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token atom symbol" style="color:#36acaa">:last_active_at</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token attr-name" style="color:#00a4db">where:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;status = &#x27;active&#x27;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">end</span><br></span></code></pre><div class="buttonGroup_Y8nk"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_FM2O" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_GhTt"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_AhUB"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_QJwc" id="83-캐싱-전략">8.3 캐싱 전략<a href="#83-캐싱-전략" class="hash-link" aria-label="Direct link to 8.3 캐싱 전략" title="Direct link to 8.3 캐싱 전략">​</a></h3>
<ol>
<li>
<p><strong>쿼리 결과 캐싱</strong>: 자주 접근하는 데이터를 캐시합니다.</p>
<div class="language-elixir codeBlockContainer_qNdj theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_enjf"><pre tabindex="0" class="prism-code language-elixir codeBlock_txiP thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_XHAo"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> get_active_users </span><span class="token keyword" style="color:#00009f">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  cache_key </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;active_users&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">case</span><span class="token plain"> </span><span class="token module class-name">MyApp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">Cache</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">cache_key</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token atom symbol" style="color:#36acaa">:ok</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> users</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">when</span><span class="token plain"> users </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">nil</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      users</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    _ </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      users </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token module class-name">User</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token operator" style="color:#393A34">|&gt;</span><span class="token plain"> </span><span class="token module class-name">Ash</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">Query</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">filter</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">status </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token atom symbol" style="color:#36acaa">:active</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token operator" style="color:#393A34">|&gt;</span><span class="token plain"> </span><span class="token module class-name">MyApp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">Accounts</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">read!</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token module class-name">MyApp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">Cache</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">put</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">cache_key</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> users</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token attr-name" style="color:#00a4db">ttl:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">300</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># 5분 캐싱</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      users</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">end</span><br></span></code></pre><div class="buttonGroup_Y8nk"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_FM2O" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_GhTt"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_AhUB"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
<li>
<p><strong>계산 결과 캐싱</strong>: 비용이 많이 드는 계산 결과를 캐시합니다.</p>
<div class="language-elixir codeBlockContainer_qNdj theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_enjf"><pre tabindex="0" class="prism-code language-elixir codeBlock_txiP thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_XHAo"><span class="token-line" style="color:#393A34"><span class="token plain">calculations </span><span class="token keyword" style="color:#00009f">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  calculate </span><span class="token atom symbol" style="color:#36acaa">:complex_score</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token atom symbol" style="color:#36acaa">:float</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token module class-name">MyApp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">Calculations</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">ComplexScore</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token attr-name" style="color:#00a4db">ttl:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3600</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">end</span><br></span></code></pre><div class="buttonGroup_Y8nk"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_FM2O" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_GhTt"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_AhUB"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_QJwc" id="9-배포-및-운영-고려사항">9. 배포 및 운영 고려사항<a href="#9-배포-및-운영-고려사항" class="hash-link" aria-label="Direct link to 9. 배포 및 운영 고려사항" title="Direct link to 9. 배포 및 운영 고려사항">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_QJwc" id="91-마이그레이션-관리">9.1 마이그레이션 관리<a href="#91-마이그레이션-관리" class="hash-link" aria-label="Direct link to 9.1 마이그레이션 관리" title="Direct link to 9.1 마이그레이션 관리">​</a></h3>
<ol>
<li>
<p><strong>안전한 마이그레이션</strong>: 하위 호환성을 유지하는 마이그레이션 설계</p>
<div class="language-elixir codeBlockContainer_qNdj theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_enjf"><pre tabindex="0" class="prism-code language-elixir codeBlock_txiP thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_XHAo"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># 안전한 열 추가</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> change </span><span class="token keyword" style="color:#00009f">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  alter </span><span class="token function" style="color:#d73a49">table</span><span class="token punctuation" style="color:#393A34">(</span><span class="token atom symbol" style="color:#36acaa">:users</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    add </span><span class="token atom symbol" style="color:#36acaa">:middle_name</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token atom symbol" style="color:#36acaa">:string</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token attr-name" style="color:#00a4db">null:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">end</span><br></span></code></pre><div class="buttonGroup_Y8nk"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_FM2O" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_GhTt"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_AhUB"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
<li>
<p><strong>마이그레이션 생성</strong>: ash_postgres 마이그레이션 스크립트 생성</p>
<div class="language-bash codeBlockContainer_qNdj theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_enjf"><pre tabindex="0" class="prism-code language-bash codeBlock_txiP thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_XHAo"><span class="token-line" style="color:#393A34"><span class="token plain">mix ash_postgres.generate_migrations</span><br></span></code></pre><div class="buttonGroup_Y8nk"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_FM2O" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_GhTt"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_AhUB"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
<li>
<p><strong>마이그레이션 적용</strong>: 마이그레이션 실행</p>
<div class="language-bash codeBlockContainer_qNdj theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_enjf"><pre tabindex="0" class="prism-code language-bash codeBlock_txiP thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_XHAo"><span class="token-line" style="color:#393A34"><span class="token plain">mix ecto.migrate</span><br></span></code></pre><div class="buttonGroup_Y8nk"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_FM2O" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_GhTt"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_AhUB"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_QJwc" id="92-배포-전략">9.2 배포 전략<a href="#92-배포-전략" class="hash-link" aria-label="Direct link to 9.2 배포 전략" title="Direct link to 9.2 배포 전략">​</a></h3>
<ol>
<li>
<p><strong>릴리스 빌드</strong>: 릴리스 패키지 생성</p>
<div class="language-bash codeBlockContainer_qNdj theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_enjf"><pre tabindex="0" class="prism-code language-bash codeBlock_txiP thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_XHAo"><span class="token-line" style="color:#393A34"><span class="token plain">MIX_ENV=prod mix release</span><br></span></code></pre><div class="buttonGroup_Y8nk"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_FM2O" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_GhTt"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_AhUB"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
<li>
<p><strong>환경 구성</strong>: 환경별 설정 관리</p>
<div class="language-elixir codeBlockContainer_qNdj theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_enjf"><pre tabindex="0" class="prism-code language-elixir codeBlock_txiP thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_XHAo"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># config/runtime.exs</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">config </span><span class="token atom symbol" style="color:#36acaa">:my_app</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token module class-name">MyApp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">Repo</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token attr-name" style="color:#00a4db">url:</span><span class="token plain"> </span><span class="token module class-name">System</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">fetch_env!</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;DATABASE_URL&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token attr-name" style="color:#00a4db">pool_size:</span><span class="token plain"> </span><span class="token module class-name">String</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">to_integer</span><span class="token punctuation" style="color:#393A34">(</span><span class="token module class-name">System</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">get_env</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;POOL_SIZE&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">||</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;10&quot;</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup_Y8nk"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_FM2O" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_GhTt"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_AhUB"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
<li>
<p><strong>릴리스 마이그레이션</strong>: 배포 시 자동 마이그레이션</p>
<div class="language-elixir codeBlockContainer_qNdj theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_enjf"><pre tabindex="0" class="prism-code language-elixir codeBlock_txiP thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_XHAo"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># lib/my_app/release.ex</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">defmodule</span><span class="token plain"> </span><span class="token module class-name">MyApp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">Release</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> migrate </span><span class="token keyword" style="color:#00009f">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token module class-name">Application</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">load</span><span class="token punctuation" style="color:#393A34">(</span><span class="token atom symbol" style="color:#36acaa">:my_app</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> repo </span><span class="token operator" style="color:#393A34">&lt;-</span><span class="token plain"> </span><span class="token module class-name">Application</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">fetch_env!</span><span class="token punctuation" style="color:#393A34">(</span><span class="token atom symbol" style="color:#36acaa">:my_app</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token atom symbol" style="color:#36acaa">:ecto_repos</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">{</span><span class="token atom symbol" style="color:#36acaa">:ok</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> _</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> _</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token module class-name">Ecto</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">Migrator</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">with_repo</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        repo</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token module class-name">Ecto</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">Migrator</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">run</span><span class="token punctuation" style="color:#393A34">(</span><span class="token argument variable" style="color:#36acaa">&amp;1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token atom symbol" style="color:#36acaa">:up</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token attr-name" style="color:#00a4db">all:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">end</span><br></span></code></pre><div class="buttonGroup_Y8nk"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_FM2O" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_GhTt"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_AhUB"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_QJwc" id="10-문제-해결-및-디버깅">10. 문제 해결 및 디버깅<a href="#10-문제-해결-및-디버깅" class="hash-link" aria-label="Direct link to 10. 문제 해결 및 디버깅" title="Direct link to 10. 문제 해결 및 디버깅">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_QJwc" id="101-일반적인-문제">10.1 일반적인 문제<a href="#101-일반적인-문제" class="hash-link" aria-label="Direct link to 10.1 일반적인 문제" title="Direct link to 10.1 일반적인 문제">​</a></h3>
<ol>
<li>
<p><strong>관계 로드 실패</strong>: 관계가 로드되지 않을 때</p>
<div class="language-elixir codeBlockContainer_qNdj theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_enjf"><pre tabindex="0" class="prism-code language-elixir codeBlock_txiP thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_XHAo"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># 문제: user.posts가 nil</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">user </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token module class-name">MyApp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">Accounts</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">get!</span><span class="token punctuation" style="color:#393A34">(</span><span class="token module class-name">User</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> id</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 해결: 명시적으로 관계 로드</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">user </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token module class-name">User</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">|&gt;</span><span class="token plain"> </span><span class="token module class-name">Ash</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">Query</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">filter</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">id </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">^</span><span class="token plain">id</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">|&gt;</span><span class="token plain"> </span><span class="token module class-name">Ash</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">Query</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">load</span><span class="token punctuation" style="color:#393A34">(</span><span class="token atom symbol" style="color:#36acaa">:posts</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">|&gt;</span><span class="token plain"> </span><span class="token module class-name">MyApp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">Accounts</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">read_one!</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup_Y8nk"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_FM2O" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_GhTt"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_AhUB"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
<li>
<p><strong>계산된 속성 접근 실패</strong>: 계산된 속성이 nil일 때</p>
<div class="language-elixir codeBlockContainer_qNdj theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_enjf"><pre tabindex="0" class="prism-code language-elixir codeBlock_txiP thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_XHAo"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># 문제: user.full_name이 nil</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">user </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token module class-name">MyApp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">Accounts</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">get!</span><span class="token punctuation" style="color:#393A34">(</span><span class="token module class-name">User</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> id</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 해결: 명시적으로 계산된 속성 로드</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">user </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token module class-name">User</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">|&gt;</span><span class="token plain"> </span><span class="token module class-name">Ash</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">Query</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">filter</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">id </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">^</span><span class="token plain">id</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">|&gt;</span><span class="token plain"> </span><span class="token module class-name">Ash</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">Query</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">load</span><span class="token punctuation" style="color:#393A34">(</span><span class="token atom symbol" style="color:#36acaa">:full_name</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">|&gt;</span><span class="token plain"> </span><span class="token module class-name">MyApp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">Accounts</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">read_one!</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup_Y8nk"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_FM2O" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_GhTt"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_AhUB"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
<li>
<p><strong>필터 인자 오류</strong>: 필터에서 인자를 사용할 때</p>
<div class="language-elixir codeBlockContainer_qNdj theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_enjf"><pre tabindex="0" class="prism-code language-elixir codeBlock_txiP thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_XHAo"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># 문제: 인자 바인딩 오류</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">query </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token module class-name">User</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">|&gt;</span><span class="token plain"> </span><span class="token module class-name">Ash</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">Query</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">filter</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">email </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> user_email</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 해결: pin 연산자(^) 사용</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">query </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token module class-name">User</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">|&gt;</span><span class="token plain"> </span><span class="token module class-name">Ash</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">Query</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">filter</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">email </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">^</span><span class="token plain">user_email</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup_Y8nk"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_FM2O" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_GhTt"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_AhUB"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_QJwc" id="102-디버깅-기술">10.2 디버깅 기술<a href="#102-디버깅-기술" class="hash-link" aria-label="Direct link to 10.2 디버깅 기술" title="Direct link to 10.2 디버깅 기술">​</a></h3>
<ol>
<li>
<p><strong>체인지셋 검사</strong>: 체인지셋 내용 확인</p>
<div class="language-elixir codeBlockContainer_qNdj theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_enjf"><pre tabindex="0" class="prism-code language-elixir codeBlock_txiP thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_XHAo"><span class="token-line" style="color:#393A34"><span class="token plain">changeset </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token module class-name">User</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">|&gt;</span><span class="token plain"> </span><span class="token module class-name">Ash</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">Changeset</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">for_create</span><span class="token punctuation" style="color:#393A34">(</span><span class="token atom symbol" style="color:#36acaa">:create</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> attrs</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token module class-name">IO</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">inspect</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">changeset</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token attr-name" style="color:#00a4db">label:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Changeset&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token module class-name">IO</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">inspect</span><span class="token punctuation" style="color:#393A34">(</span><span class="token module class-name">Ash</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">Changeset</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">get_attributes</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">changeset</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token attr-name" style="color:#00a4db">label:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Attributes&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token module class-name">IO</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">inspect</span><span class="token punctuation" style="color:#393A34">(</span><span class="token module class-name">Ash</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">Changeset</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">get_errors</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">changeset</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token attr-name" style="color:#00a4db">label:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Errors&quot;</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup_Y8nk"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_FM2O" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_GhTt"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_AhUB"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
<li>
<p><strong>쿼리 인스펙션</strong>: 생성된 SQL 쿼리 확인 (PostgreSQL)</p>
<div class="language-elixir codeBlockContainer_qNdj theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_enjf"><pre tabindex="0" class="prism-code language-elixir codeBlock_txiP thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_XHAo"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># config/dev.exs</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">config </span><span class="token atom symbol" style="color:#36acaa">:ash_postgres</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token atom symbol" style="color:#36acaa">:repo_log_level</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token atom symbol" style="color:#36acaa">:debug</span><br></span></code></pre><div class="buttonGroup_Y8nk"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_FM2O" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_GhTt"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_AhUB"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
<li>
<p><strong>에러 처리</strong>: 상세 에러 정보 확인</p>
<div class="language-elixir codeBlockContainer_qNdj theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_enjf"><pre tabindex="0" class="prism-code language-elixir codeBlock_txiP thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_XHAo"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">case</span><span class="token plain"> </span><span class="token module class-name">MyApp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token module class-name">Accounts</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">create</span><span class="token punctuation" style="color:#393A34">(</span><span class="token module class-name">User</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> attrs</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">{</span><span class="token atom symbol" style="color:#36acaa">:ok</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> user</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># 성공 처리</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">{</span><span class="token atom symbol" style="color:#36acaa">:error</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> error</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token module class-name">IO</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">inspect</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">error</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token attr-name" style="color:#00a4db">label:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Error&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token module class-name">IO</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">inspect</span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">errors_on</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">error</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token attr-name" style="color:#00a4db">label:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Errors On&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># 에러 처리</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">end</span><br></span></code></pre><div class="buttonGroup_Y8nk"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_FM2O" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_GhTt"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_AhUB"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_QJwc" id="11-참고-자료">11. 참고 자료<a href="#11-참고-자료" class="hash-link" aria-label="Direct link to 11. 참고 자료" title="Direct link to 11. 참고 자료">​</a></h2>
<ul>
<li><a href="https://hexdocs.pm/ash/get-started.html" target="_blank" rel="noopener noreferrer">Ash Framework 공식 문서</a></li>
<li><a href="https://ash-hq.org/docs/extensions" target="_blank" rel="noopener noreferrer">Ash Extensions 문서</a></li>
<li><a href="https://hexdocs.pm/ash_postgres/AshPostgres.html" target="_blank" rel="noopener noreferrer">Ash Postgres 문서</a></li>
<li><a href="https://hexdocs.pm/ash_phoenix/AshPhoenix.html" target="_blank" rel="noopener noreferrer">Ash Phoenix 문서</a></li>
<li><a href="https://elixirforum.com/c/elixir-framework-forum/ash-framework/107" target="_blank" rel="noopener noreferrer">Elixir Forum - Ash 카테고리</a></li>
</ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/AutomataOOO/automata_docs/tree/main/docs/automata-signal/guides/GUIDE-006-framework-specific.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Wowa" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_MFKL"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/automata-signal/guides/GUIDE-005-deployment-workflow"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">[GUIDE-005] 배포 워크플로우</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/automata-signal/designs/DESIGN-001-architecture-overview"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">[DESIGN-001] 아키텍처 개요</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_G4nv thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#요약" class="table-of-contents__link toc-highlight">요약</a></li><li><a href="#1-ash-framework-개요" class="table-of-contents__link toc-highlight">1. Ash Framework 개요</a><ul><li><a href="#11-ash-framework란" class="table-of-contents__link toc-highlight">1.1 Ash Framework란?</a></li><li><a href="#12-주요-구성-요소" class="table-of-contents__link toc-highlight">1.2 주요 구성 요소</a></li></ul></li><li><a href="#2-ash-리소스-정의-가이드" class="table-of-contents__link toc-highlight">2. Ash 리소스 정의 가이드</a><ul><li><a href="#21-리소스-기본-구조" class="table-of-contents__link toc-highlight">2.1 리소스 기본 구조</a></li><li><a href="#22-속성-정의-모범-사례" class="table-of-contents__link toc-highlight">2.2 속성 정의 모범 사례</a></li><li><a href="#23-관계-정의-모범-사례" class="table-of-contents__link toc-highlight">2.3 관계 정의 모범 사례</a></li><li><a href="#24-계산-및-집계-정의" class="table-of-contents__link toc-highlight">2.4 계산 및 집계 정의</a></li></ul></li><li><a href="#3-ash-확장-모듈-활용-가이드" class="table-of-contents__link toc-highlight">3. Ash 확장 모듈 활용 가이드</a><ul><li><a href="#31-ashstatemachine" class="table-of-contents__link toc-highlight">3.1 AshStateMachine</a></li><li><a href="#32-asharchival" class="table-of-contents__link toc-highlight">3.2 AshArchival</a></li><li><a href="#33-ashpapertrail" class="table-of-contents__link toc-highlight">3.3 AshPaperTrail</a></li><li><a href="#34-ashoban" class="table-of-contents__link toc-highlight">3.4 AshOban</a></li><li><a href="#35-ashcloak" class="table-of-contents__link toc-highlight">3.5 AshCloak</a></li><li><a href="#36-ashmoney-및-ashdoubleentry" class="table-of-contents__link toc-highlight">3.6 AshMoney 및 AshDoubleEntry</a></li></ul></li><li><a href="#4-ash-액션-구현-가이드" class="table-of-contents__link toc-highlight">4. Ash 액션 구현 가이드</a><ul><li><a href="#41-기본-crud-액션" class="table-of-contents__link toc-highlight">4.1 기본 CRUD 액션</a></li><li><a href="#42-커스텀-액션-정의" class="table-of-contents__link toc-highlight">4.2 커스텀 액션 정의</a></li><li><a href="#43-액션-인자-및-유효성-검사" class="table-of-contents__link toc-highlight">4.3 액션 인자 및 유효성 검사</a></li><li><a href="#44-액션-변경-함수" class="table-of-contents__link toc-highlight">4.4 액션 변경 함수</a></li></ul></li><li><a href="#5-ash-쿼리-및-데이터-로딩-가이드" class="table-of-contents__link toc-highlight">5. Ash 쿼리 및 데이터 로딩 가이드</a><ul><li><a href="#51-기본-쿼리-작성" class="table-of-contents__link toc-highlight">5.1 기본 쿼리 작성</a></li><li><a href="#52-필터링-표현식" class="table-of-contents__link toc-highlight">5.2 필터링 표현식</a></li><li><a href="#53-관계-로딩" class="table-of-contents__link toc-highlight">5.3 관계 로딩</a></li><li><a href="#54-계산-및-집계-로딩" class="table-of-contents__link toc-highlight">5.4 계산 및 집계 로딩</a></li><li><a href="#55-페이지네이션" class="table-of-contents__link toc-highlight">5.5 페이지네이션</a></li><li><a href="#56-트랜잭션-및-일괄-처리" class="table-of-contents__link toc-highlight">5.6 트랜잭션 및 일괄 처리</a></li></ul></li><li><a href="#6-domain-및-api-모듈-구성-가이드" class="table-of-contents__link toc-highlight">6. Domain 및 API 모듈 구성 가이드</a><ul><li><a href="#61-domain-모듈-정의" class="table-of-contents__link toc-highlight">6.1 Domain 모듈 정의</a></li><li><a href="#62-api-액션-호출" class="table-of-contents__link toc-highlight">6.2 API 액션 호출</a></li><li><a href="#63-api-컨텍스트-설정" class="table-of-contents__link toc-highlight">6.3 API 컨텍스트 설정</a></li></ul></li><li><a href="#7-테스트-가이드" class="table-of-contents__link toc-highlight">7. 테스트 가이드</a><ul><li><a href="#71-기본-리소스-테스트" class="table-of-contents__link toc-highlight">7.1 기본 리소스 테스트</a></li><li><a href="#72-관계-테스트" class="table-of-contents__link toc-highlight">7.2 관계 테스트</a></li><li><a href="#73-액션-테스트" class="table-of-contents__link toc-highlight">7.3 액션 테스트</a></li><li><a href="#74-쿼리-테스트" class="table-of-contents__link toc-highlight">7.4 쿼리 테스트</a></li></ul></li><li><a href="#8-성능-최적화-팁" class="table-of-contents__link toc-highlight">8. 성능 최적화 팁</a><ul><li><a href="#81-데이터-로딩-최적화" class="table-of-contents__link toc-highlight">8.1 데이터 로딩 최적화</a></li><li><a href="#82-쿼리-최적화" class="table-of-contents__link toc-highlight">8.2 쿼리 최적화</a></li><li><a href="#83-캐싱-전략" class="table-of-contents__link toc-highlight">8.3 캐싱 전략</a></li></ul></li><li><a href="#9-배포-및-운영-고려사항" class="table-of-contents__link toc-highlight">9. 배포 및 운영 고려사항</a><ul><li><a href="#91-마이그레이션-관리" class="table-of-contents__link toc-highlight">9.1 마이그레이션 관리</a></li><li><a href="#92-배포-전략" class="table-of-contents__link toc-highlight">9.2 배포 전략</a></li></ul></li><li><a href="#10-문제-해결-및-디버깅" class="table-of-contents__link toc-highlight">10. 문제 해결 및 디버깅</a><ul><li><a href="#101-일반적인-문제" class="table-of-contents__link toc-highlight">10.1 일반적인 문제</a></li><li><a href="#102-디버깅-기술" class="table-of-contents__link toc-highlight">10.2 디버깅 기술</a></li></ul></li><li><a href="#11-참고-자료" class="table-of-contents__link toc-highlight">11. 참고 자료</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 Automata, Inc.</div></div></div></footer></div>
</body>
</html>